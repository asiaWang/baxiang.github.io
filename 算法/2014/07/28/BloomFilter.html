<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]-->

    <title>BloomFilter</title>
    <meta name="description" content="">

    <link rel="stylesheet" type="text/css" href="/assets/css/style.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/font-awesome.min.css">

  </head>
  <body>
    <aside id="sidebar">
      <nav id="tags">
        <a href="/index.html" id="avatar"></a>

        <ul id="tags__ul">
          <li id="js-label1" class="tags__li tags-btn active">所有文章 <span class="post_count"></span></li>
          <li id="js-label2" class="tags__li tags-btn">并发<span class="post_count"></span></li>
          <li id="js-label3" class="tags__li tags-btn">jvm<span class="post_count"></span></li>
          <li id="js-label4" class="tags__li tags-btn">算法<span class="post_count"></span></li>
          <li id="js-label5" class="tags__li tags-btn">数据库<span class="post_count"></span></li>
          <li id="js-label6" class="tags__li tags-btn">cache<span class="post_count"></span></li>
          <li id="js-label7" class="tags__li tags-btn">c和os<span class="post_count"></span></li>
          <li id="js-label8" class="tags__li tags-btn">网络<span class="post_count"></span></li>
          <li id="js-label9" class="tags__li tags-btn">工作<span class="post_count"></span></li>
        </ul>

        <div id="tags__bottom">
          <a href="mailto:novohust@163.com" id="icon-email" class="tags-btn fontello"></a>
          <a href="/rss.xml" id="icon-feed" class="tags-btn fontello"></a>
        </div>
      </nav> <!-- end #tags -->

      <div id="posts-list">
        <form action="" id="search-form">
          <a href="/index.html" id="mobile-avatar"></a>
          <!-- NOTE: input field is disabled by default -->
          <input id="search-input" type="text" placeholder="Search..." disabled >
        </form>

        <nav id="pl__container">
        
          <a class="并发 pl__all" href="/%E5%B9%B6%E5%8F%91/2014/09/11/ThreadLocal%20%E5%88%86%E6%9E%90.html"><span class="pl__circle"></span><span class="pl__title">ThreadLocal 分析</span><span class="pl__date">Sep 2014</span></a>
        
          <a class="工作 pl__all" href="/%E5%B7%A5%E4%BD%9C/2014/09/04/MapReduce%20Algorithms.html"><span class="pl__circle"></span><span class="pl__title">MapReduce Algorithms</span><span class="pl__date">Sep 2014</span></a>
        
          <a class="网络 pl__all" href="/%E7%BD%91%E7%BB%9C/2014/09/03/%E9%AB%98%E6%80%A7%E8%83%BD%E7%BD%91%E7%BB%9C%E9%80%9A%E8%AE%AF%E7%AC%94%E8%AE%B0.html"><span class="pl__circle"></span><span class="pl__title">高性能网络通讯笔记</span><span class="pl__date">Sep 2014</span></a>
        
          <a class="工作 pl__all" href="/%E5%B7%A5%E4%BD%9C/2014/09/03/Skyline%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html"><span class="pl__circle"></span><span class="pl__title">Skyline监控系统工作原理分析</span><span class="pl__date">Sep 2014</span></a>
        
          <a class="工作 pl__all" href="/%E5%B7%A5%E4%BD%9C/2014/09/03/Skyline%20timeseries%E5%BC%82%E5%B8%B8%E5%88%A4%E5%AE%9A%E7%AE%97%E6%B3%95.html"><span class="pl__circle"></span><span class="pl__title">Skyline timeseries异常判定算法</span><span class="pl__date">Sep 2014</span></a>
        
          <a class="算法 pl__all" href="/%E7%AE%97%E6%B3%95/2014/08/05/%E6%8E%92%E5%BA%8F%E6%80%BB%E7%BB%93.html"><span class="pl__circle"></span><span class="pl__title">排序总结</span><span class="pl__date">Aug 2014</span></a>
        
          <a class="算法 pl__all" href="/%E7%AE%97%E6%B3%95/2014/08/05/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F.html"><span class="pl__circle"></span><span class="pl__title">快速排序</span><span class="pl__date">Aug 2014</span></a>
        
          <a class="算法 pl__all" href="/%E7%AE%97%E6%B3%95/2014/08/05/%E5%87%A0%E4%B8%AA%E5%B8%B8%E8%A7%81%E7%9A%84%E6%A6%82%E7%8E%87%E9%97%AE%E9%A2%98.html"><span class="pl__circle"></span><span class="pl__title">几个常见的概率问题</span><span class="pl__date">Aug 2014</span></a>
        
          <a class="网络 pl__all" href="/%E7%BD%91%E7%BB%9C/2014/07/31/%E5%B8%B8%E8%A7%81%E7%9A%84HTTP%E7%8A%B6%E6%80%81%E7%A0%81.html"><span class="pl__circle"></span><span class="pl__title">常见的HTTP状态码</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="算法 pl__all" href="/%E7%AE%97%E6%B3%95/2014/07/28/BloomFilter.html"><span class="pl__circle"></span><span class="pl__title">BloomFilter</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="jvm pl__all" href="/jvm/2014/07/27/gc.html"><span class="pl__circle"></span><span class="pl__title">JVM GC调优</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="网络 pl__all" href="/%E7%BD%91%E7%BB%9C/2014/07/26/%E9%AB%98%E6%80%A7%E8%83%BD%E7%BD%91%E7%BB%9C%E9%80%9A%E8%AE%AF%E7%AC%94%E8%AE%B0.html"><span class="pl__circle"></span><span class="pl__title">高性能网络通讯笔记</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="算法 pl__all" href="/%E7%AE%97%E6%B3%95/2014/07/26/%E9%9D%9E%E9%80%92%E5%BD%92%E7%9A%84%E4%BA%8C%E5%8F%89%E6%A0%91%E9%81%8D%E5%8E%86.html"><span class="pl__circle"></span><span class="pl__title">二叉树的各种遍历</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="网络 pl__all" href="/%E7%BD%91%E7%BB%9C/2014/07/26/%E9%93%BE%E8%B7%AF%E5%B1%82%20%E7%BD%91%E7%BB%9C%E5%B1%82%20UDP%20IO%E6%A8%A1%E5%9E%8B.html"><span class="pl__circle"></span><span class="pl__title">链路层 网络层 UDP IO模型</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="算法 pl__all" href="/%E7%AE%97%E6%B3%95/2014/07/26/%E8%B4%9D%E5%8F%B6%E6%96%AF.html"><span class="pl__circle"></span><span class="pl__title">贝叶斯</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="算法 pl__all" href="/%E7%AE%97%E6%B3%95/2014/07/26/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98.html"><span class="pl__circle"></span><span class="pl__title">背包问题</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="c和os pl__all" href="/c%E5%92%8Cos/2014/07/26/%E7%BD%91%E5%8D%A1%E4%B8%AD%E6%96%AD%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html"><span class="pl__circle"></span><span class="pl__title">网卡中断负载均衡</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="算法 pl__all" href="/%E7%AE%97%E6%B3%95/2014/07/26/%E7%BA%BF%E6%AE%B5%E6%A0%91.html"><span class="pl__circle"></span><span class="pl__title">线段树</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="算法 pl__all" href="/%E7%AE%97%E6%B3%95/2014/07/26/%E6%A1%B6%E6%8E%92%E5%BA%8F%E5%9C%A8%E6%8E%92%E8%A1%8C%E6%A6%9C%E9%97%AE%E9%A2%98%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8.html"><span class="pl__circle"></span><span class="pl__title">桶排序在排行榜问题中的应用</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="算法 pl__all" href="/%E7%AE%97%E6%B3%95/2014/07/26/%E5%B9%B6%E6%9F%A5%E9%9B%86.html"><span class="pl__circle"></span><span class="pl__title">并查集</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="并发 pl__all" href="/%E5%B9%B6%E5%8F%91/2014/07/26/%E5%B9%B6%E5%8F%91%E9%9B%86%E5%90%88.html"><span class="pl__circle"></span><span class="pl__title">并发集合</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="并发 pl__all" href="/%E5%B9%B6%E5%8F%91/2014/07/26/%E5%AE%9A%E6%97%B6%E5%99%A8%EF%BC%88Timer%EF%BC%89%E7%9A%84%E5%AE%9E%E7%8E%B0.html"><span class="pl__circle"></span><span class="pl__title">定时器（Timer）的实现</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="算法 pl__all" href="/%E7%AE%97%E6%B3%95/2014/07/26/%E5%A0%86.html"><span class="pl__circle"></span><span class="pl__title">堆</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="算法 pl__all" href="/%E7%AE%97%E6%B3%95/2014/07/26/%E5%9B%9E%E6%BA%AF.html"><span class="pl__circle"></span><span class="pl__title">回溯</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="算法 pl__all" href="/%E7%AE%97%E6%B3%95/2014/07/26/%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%B4%A2%E5%BC%95%E6%A0%91(%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84).html"><span class="pl__circle"></span><span class="pl__title">二进制索引树(树状数组)</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="网络 pl__all" href="/%E7%BD%91%E7%BB%9C/2014/07/26/TCP.html"><span class="pl__circle"></span><span class="pl__title">TCP</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="网络 pl__all" href="/%E7%BD%91%E7%BB%9C/2014/07/26/RST%E5%8F%8Ajava%20socket%E5%85%B3%E9%97%AD%E5%90%8E%E8%AF%BB%E5%86%99%E7%9A%84%E5%90%84%E7%A7%8D%E5%BC%82%E5%B8%B8.html"><span class="pl__circle"></span><span class="pl__title">RST及java socket关闭后读写的各种异常</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="网络 pl__all" href="/%E7%BD%91%E7%BB%9C/2014/07/26/Netty3%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html"><span class="pl__circle"></span><span class="pl__title">Netty3 源码分析</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="网络 pl__all" href="/%E7%BD%91%E7%BB%9C/2014/07/26/Netty3%204%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%8C%BA%E5%88%AB.html"><span class="pl__circle"></span><span class="pl__title">Netty3 4线程模型的区别</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="数据库 pl__all" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/2014/07/26/MySQL%E6%80%BB%E7%BB%93.html"><span class="pl__circle"></span><span class="pl__title">MySQL总结</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="c和os pl__all" href="/c%E5%92%8Cos/2014/07/26/Mode%20Switch%20%E5%92%8C%20Context%20Switch.html"><span class="pl__circle"></span><span class="pl__title">Mode Switch 和 Context Switch</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="并发 pl__all" href="/%E5%B9%B6%E5%8F%91/2014/07/26/Lock-Free%20%E7%AE%97%E6%B3%95.html"><span class="pl__circle"></span><span class="pl__title">Lock-Free 算法</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="算法 pl__all" href="/%E7%AE%97%E6%B3%95/2014/07/26/LCA%20%E5%92%8C%20RMQ.html"><span class="pl__circle"></span><span class="pl__title">LCA 和 RMQ</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="算法 pl__all" href="/%E7%AE%97%E6%B3%95/2014/07/26/KMP.html"><span class="pl__circle"></span><span class="pl__title">KMP</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="并发 pl__all" href="/%E5%B9%B6%E5%8F%91/2014/07/26/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html"><span class="pl__circle"></span><span class="pl__title">Java内存模型</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="并发 pl__all" href="/%E5%B9%B6%E5%8F%91/2014/07/26/Java%20%E5%B9%B6%E5%8F%91%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html"><span class="pl__circle"></span><span class="pl__title">Java 并发基本知识</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="cache pl__all" href="/cache/2014/07/26/Http%E5%8D%8F%E8%AE%AE%E4%B8%AD%E7%9A%84cache%E6%9C%BA%E5%88%B6.html"><span class="pl__circle"></span><span class="pl__title">Http协议中的cache机制</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="算法 pl__all" href="/%E7%AE%97%E6%B3%95/2014/07/26/Hash%20&%20Rabin-Karp%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9F%A5%E6%89%BE%E7%AE%97%E6%B3%95.html"><span class="pl__circle"></span><span class="pl__title">Hash & Rabin-Karp字符串查找算法</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="并发 pl__all" href="/%E5%B9%B6%E5%8F%91/2014/07/26/Executor%20%E4%B9%8B%20%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8F%8A%E5%AE%9A%E6%97%B6%E5%99%A8.html"><span class="pl__circle"></span><span class="pl__title">Executor 之 线程池及定时器</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="c和os pl__all" href="/c%E5%92%8Cos/2014/07/26/C%E6%80%BB%E7%BB%93%20+%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98.html"><span class="pl__circle"></span><span class="pl__title">C总结 + 虚拟内存</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="cache pl__all" href="/cache/2014/07/26/Cache%20%E7%9B%B8%E5%85%B3%E7%90%86%E8%AE%BA.html"><span class="pl__circle"></span><span class="pl__title">Cache 相关理论</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="c和os pl__all" href="/c%E5%92%8Cos/2014/07/26/CPU%20Cache%20%E4%B8%8E%20%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84.html"><span class="pl__circle"></span><span class="pl__title">CPU Cache 与 存储器层次结构</span><span class="pl__date">Jul 2014</span></a>
        
          <a class="并发 pl__all" href="/%E5%B9%B6%E5%8F%91/2014/07/26/AQS%20%E5%92%8C%20%E9%AB%98%E7%BA%A7%E5%90%8C%E6%AD%A5%E5%99%A8.html"><span class="pl__circle"></span><span class="pl__title">AQS 和 高级同步器</span><span class="pl__date">Jul 2014</span></a>
        
        </nav>
      </div> <!-- end #posts-list -->
    </aside> <!-- end #sidebar -->

    <div id="post">
      <div id="pjax">
        <article id="post__content">
  <h1 id="post__title" data-identifier="20140728">BloomFilter</h1>
  <div style="line-height: 1.6; font-family: Helvetica Neue, Arial, Hiragino Sans GB, STHeiti, Microsoft YaHei, WenQuanYi Micro Hei, SimSun, Song, sans-serif;">
<h2 style="font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 30px; margin-bottom: 20px; font-size: 30px;">1. 原理</h2>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">BloomFilter 是一种基于 <strong style="font-weight: bold; margin-top: 0px;">bit 数组 + 多重hash</strong> 的数据结构，用于判断一个元素是否在一个集合中。</p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">BloomFilter 在内部维护一个长度为 m 的bit数组，并提供 k 个 hash 函数。当一个元素被加入集合时，用这些 hash 函数计算出 k 个数组位置并赋为 1。为了查询一个元素是否在集合中，同样地用 hash 函数计算出该元素在 bit 数组中的 k 个位置，如果全部为 1 就认为在集合中。</p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">当k很大时，设计k个独立的hash function是不现实并且困难的。对于一个输出范围很大的hash function（例如MD5产生的128 bits数），如果不同bit位的相关性很小，则可把此输出分割为k份。或者可将k个不同的初始值（例如0,1,2, … ,k-1）结合元素，feed给一个hash function从而产生k个不同的数。</p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">可以看到，BloomFilter 有两个缺点：</p>
<ol style="margin-top: 0; margin-bottom: 10px; line-height: 1.6;">
<li style="line-height: 1.6; margin-top: 0px;">不支持 remove 元素；</li>
<li style="line-height: 1.6;">对一个不在集合中的元素，有可能误判；而且误判率会随着元素的增多而升高。因此不适合要求精确的场合。</li>
</ol>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">BloomFilter 最大的优点是它是基于 bit 数组的，不保存元素本身，因此非常节省空间；同等规模的集合，BloomFilter 占用的空间可能只有 HashSet 的 1/4 或更少。</p>
<h2 style="font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 30px; margin-bottom: 20px; font-size: 30px;">2. 误判率的计算</h2>
<blockquote style="padding: 15px 20px; margin: 0 0 15px 0; font-size: 14px; border-left: 5px solid #ddd; background-color: rgba(102, 128, 153, 0.05);">
<p style="margin: 0 0 10px; margin-bottom: 0; line-height: 1.6; font-size: 14px; font-weight: 300; white-space: pre-wrap; word-wrap: break-word; margin-top: 0px;"> m:    bit 数组长度<br style="margin-top: 0px;"/>  n:    集合元素个数<br/>  k:    hash 函数个数<br/>  p:    误判概率</p>
</blockquote><p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">很显然，误判概率 p 是关于 m/n/k 的函数:</p>
<div style="margin: 20px 0; text-align: center;"><span style="margin-top: 0px;"></span><span><div style="white-space: nowrap; margin-top: 0px;"><span style="width: 6.551em; display: inline-block; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 5.42em; height: 0px; font-size: 120%; margin-top: 0px;"><span style="position: absolute; clip: rect(1.729em 1000.003em 2.92em -0.592em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">p</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.301em;">=</span><span style="font-family:STIXGeneral-Italic, serif; padding-left: 0.301em;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.122em; margin-top: 0px;"></span></span><span style="font-family:STIXGeneral-Regular, serif;">(</span><span style="font-family:STIXGeneral-Italic, serif;">m</span><span style="font-family:STIXGeneral-Regular, serif;">,</span><span style="font-family:STIXGeneral-Italic, serif; padding-left: 0.182em;">n</span><span style="font-family:STIXGeneral-Regular, serif;">,</span><span style="font-family:STIXGeneral-Italic, serif; padding-left: 0.182em;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em; margin-top: 0px;"></span></span><span style="font-family:STIXGeneral-Regular, serif;">)</span></span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.218em; vertical-align: -0.282em;"></span></span></div></span></div>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">假设一个 hash 函数计算得到的位置等概率地分布在 bit 数组范围内，那么对于一个 bit 位，一次 hash 后它为 0 的概率是：</p>
<div style="margin: 20px 0; text-align: center;"><span style="margin-top: 0px;"></span><span><div style="white-space: nowrap; margin-top: 0px;"><span style="width: 3.396em; display: inline-block; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 2.801em; height: 0px; font-size: 120%; margin-top: 0px;"><span style="position: absolute; clip: rect(1.015em 1000.003em 3.455em -0.414em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">1</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.241em;">−</span><span style="padding-left: 0.241em;"><span style="margin-top: 0px;"><span style="padding-left: 0.122em; padding-right: 0.122em; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 0.896em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.729em 1000.003em 2.741em -0.414em); top: -3.211em; left: 50%; margin-left: -0.235em; margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">1</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; clip: rect(1.967em 1000.003em 2.741em -0.533em); top: -1.842em; left: 50%; margin-left: -0.354em;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">m</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; clip: rect(0.836em 1000.003em 1.253em -0.533em); top: -1.307em; left: 0.003em;"><span style="border-left-width: 0.896em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.003em; margin-top: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 2.575em; vertical-align: -0.925em;"></span></span></div></span></div>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">一个元素被加入集合后，该 bit 依然为 0 的概率是:</p>
<div style="margin: 20px 0; text-align: center;"><span style="margin-top: 0px;"></span><span><div style="white-space: nowrap; margin-top: 0px;"><span style="width: 4.765em; display: inline-block; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 3.932em; height: 0px; font-size: 120%; margin-top: 0px;"><span style="position: absolute; clip: rect(1.015em 1000.003em 3.455em -0.473em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">(</span><span style="font-family:STIXGeneral-Regular, serif;">1</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.241em;">−</span><span style="padding-left: 0.241em;"><span style="margin-top: 0px;"><span style="padding-left: 0.122em; padding-right: 0.122em; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 0.896em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.729em 1000.003em 2.741em -0.414em); top: -3.211em; left: 50%; margin-left: -0.235em; margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">1</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; clip: rect(1.967em 1000.003em 2.741em -0.533em); top: -1.842em; left: 50%; margin-left: -0.354em;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">m</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; clip: rect(0.836em 1000.003em 1.253em -0.533em); top: -1.307em; left: 0.003em;"><span style="border-left-width: 0.896em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.003em; margin-top: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span></span></span><span><span style="display: inline-block; position: relative; width: 0.777em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.729em 1000.003em 2.92em -0.533em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">)</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; top: -2.676em; left: 0.36em;"><span style="font-size: 70.7%; font-family: STIXGeneral-Italic, serif; margin-top: 0px;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em; margin-top: 0px;"></span></span><span style="display: inline-block; width: 0px; height: 2.265em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 2.575em; vertical-align: -0.925em;"></span></span></div></span></div>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">n 个元素加入集合后，该 bit 为 0 的概率是：</p>
<div style="margin: 20px 0; text-align: center;"><span style="margin-top: 0px;"></span><span><div style="white-space: nowrap; margin-top: 0px;"><span style="width: 5.182em; display: inline-block; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 4.289em; height: 0px; font-size: 120%; margin-top: 0px;"><span style="position: absolute; clip: rect(1.015em 1000.003em 3.455em -0.473em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">(</span><span style="font-family:STIXGeneral-Regular, serif;">1</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.241em;">−</span><span style="padding-left: 0.241em;"><span style="margin-top: 0px;"><span style="padding-left: 0.122em; padding-right: 0.122em; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 0.896em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.729em 1000.003em 2.741em -0.414em); top: -3.211em; left: 50%; margin-left: -0.235em; margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">1</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; clip: rect(1.967em 1000.003em 2.741em -0.533em); top: -1.842em; left: 50%; margin-left: -0.354em;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">m</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; clip: rect(0.836em 1000.003em 1.253em -0.533em); top: -1.307em; left: 0.003em;"><span style="border-left-width: 0.896em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.003em; margin-top: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span></span></span><span><span style="display: inline-block; position: relative; width: 1.134em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.729em 1000.003em 2.92em -0.533em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">)</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; top: -2.676em; left: 0.36em;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-size: 70.7%; font-family: STIXGeneral-Italic, serif; margin-top: 0px;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em; margin-top: 0px;"></span></span><span style="font-size: 70.7%; font-family:STIXGeneral-Italic, serif;">n</span></span></span><span style="display: inline-block; width: 0px; height: 2.265em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 2.575em; vertical-align: -0.925em;"></span></span></div></span></div>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">现在查询一个不在集合中的元素，当它所对应的 k 个位置都为 1 时会发生误判，这个概率 p 是：</p>
<div style="margin: 20px 0; text-align: center;"><span style="margin-top: 0px;"></span><span><div style="white-space: nowrap; margin-top: 0px;"><span style="width: 10.658em; display: inline-block; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 8.872em; height: 0px; font-size: 120%; margin-top: 0px;"><span style="position: absolute; clip: rect(1.015em 1000.003em 3.455em -0.592em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">p</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.301em;">=</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.301em;">(</span><span style="font-family:STIXGeneral-Regular, serif;">1</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.241em;">−</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.241em;">(</span><span style="font-family:STIXGeneral-Regular, serif;">1</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.241em;">−</span><span style="padding-left: 0.241em;"><span style="margin-top: 0px;"><span style="padding-left: 0.122em; padding-right: 0.122em; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 0.896em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.729em 1000.003em 2.741em -0.414em); top: -3.211em; left: 50%; margin-left: -0.235em; margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">1</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; clip: rect(1.967em 1000.003em 2.741em -0.533em); top: -1.842em; left: 50%; margin-left: -0.354em;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">m</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; clip: rect(0.836em 1000.003em 1.253em -0.533em); top: -1.307em; left: 0.003em;"><span style="border-left-width: 0.896em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.003em; margin-top: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span></span></span><span><span style="display: inline-block; position: relative; width: 1.134em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.729em 1000.003em 2.92em -0.533em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">)</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; top: -2.676em; left: 0.36em;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-size: 70.7%; font-family: STIXGeneral-Italic, serif; margin-top: 0px;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em; margin-top: 0px;"></span></span><span style="font-size: 70.7%; font-family:STIXGeneral-Italic, serif;">n</span></span></span><span style="display: inline-block; width: 0px; height: 2.265em;"></span></span></span></span><span><span style="display: inline-block; position: relative; width: 0.777em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.729em 1000.003em 2.92em -0.533em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">)</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; top: -2.676em; left: 0.36em;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-size: 70.7%; font-family: STIXGeneral-Italic, serif; margin-top: 0px;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em; margin-top: 0px;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.265em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 2.575em; vertical-align: -0.925em;"></span></span></div></span></div>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">由于 <span style="display: inline-block; margin: 0; margin-top: 0px;"><span style="margin-top: 0px;"></span><span><span style="white-space: nowrap; margin-top: 0px;"><span style="width: 4.408em; display: inline-block; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 3.634em; height: 0px; font-size: 120%; margin-top: 0px;"><span style="position: absolute; clip: rect(1.313em 1000.003em 2.92em -0.473em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">(</span><span style="font-family:STIXGeneral-Regular, serif;">1</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.241em;">+</span><span style="font-family:STIXGeneral-Italic, serif; padding-left: 0.241em;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em; margin-top: 0px;"></span></span><span><span style="display: inline-block; position: relative; width: 1.134em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.729em 1000.003em 2.92em -0.533em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">)</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; top: -4.402em; left: 0.36em;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="padding-left: 0.122em; padding-right: 0.122em; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 0.479em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.729em 1000.003em 2.443em -0.473em); top: -2.616em; left: 50%; margin-left: -0.176em; margin-top: 0px;"><span style="font-size: 50%; font-family: STIXGeneral-Regular, serif; margin-top: 0px;">1</span><span style="display: inline-block; width: 0px; height: 2.265em;"></span></span><span style="position: absolute; clip: rect(1.848em 1000.003em 2.443em -0.533em); top: -2.021em; left: 50%; margin-left: -0.176em;"><span style="font-size: 50%; font-family: STIXGeneral-Italic, serif; margin-top: 0px;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em; margin-top: 0px;"></span></span><span style="display: inline-block; width: 0px; height: 2.265em;"></span></span><span style="position: absolute; clip: rect(0.836em 1000.003em 1.253em -0.533em); top: -1.188em; left: 0.003em;"><span style="border-left-width: 0.479em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.003em; margin-top: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.646em; vertical-align: -0.282em;"></span></span></span></span></span> 当x逼近0时约等于 <span style="display:inline-block;margin:0"><span style="margin-top: 0px;"></span><span><span style="white-space: nowrap; margin-top: 0px;"><span style="width: 0.598em; display: inline-block; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 0.479em; height: 0px; font-size: 120%; margin-top: 0px;"><span style="position: absolute; clip: rect(1.967em 1000.003em 2.741em -0.473em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">e</span></span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.718em; vertical-align: -0.068em;"></span></span></span></span></span>，因此有：</p>
<div style="margin: 20px 0; text-align: center;"><span style="margin-top: 0px;"></span><span><div style="white-space: nowrap; margin-top: 0px;"><span style="width: 7.443em; display: inline-block; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 6.193em; height: 0px; font-size: 120%; margin-top: 0px;"><span style="position: absolute; clip: rect(1.313em 1000.003em 2.92em -0.592em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">p</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.301em;">=</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.301em;">(</span><span style="font-family:STIXGeneral-Regular, serif;">1</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.241em;">−</span><span style="padding-left: 0.241em;"><span style="display: inline-block; position: relative; width: 1.61em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.967em 1000.003em 2.741em -0.473em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">e</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; top: -4.342em; left: 0.479em;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="padding-left: 0.122em; padding-right: 0.122em; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 0.836em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.729em 1000.003em 2.443em -0.533em); top: -2.616em; left: 50%; margin-left: -0.354em; margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-size: 50%; font-family: STIXGeneral-Italic, serif; margin-top: 0px;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em; margin-top: 0px;"></span></span><span style="font-size: 50%; font-family:STIXGeneral-Italic, serif;">n</span></span><span style="display: inline-block; width: 0px; height: 2.265em;"></span></span><span style="position: absolute; clip: rect(1.848em 1000.003em 2.443em -0.533em); top: -2.021em; left: 50%; margin-left: -0.235em;"><span style="font-size: 50%; font-family: STIXGeneral-Italic, serif; margin-top: 0px;">m</span><span style="display: inline-block; width: 0px; height: 2.265em;"></span></span><span style="position: absolute; clip: rect(0.836em 1000.003em 1.253em -0.533em); top: -1.188em; left: 0.003em;"><span style="border-left-width: 0.836em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.003em; margin-top: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span><span><span style="display: inline-block; position: relative; width: 0.777em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.729em 1000.003em 2.92em -0.533em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">)</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; top: -2.676em; left: 0.36em;"><span style="font-size: 70.7%; font-family: STIXGeneral-Italic, serif; margin-top: 0px;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em; margin-top: 0px;"></span></span><span style="display: inline-block; width: 0px; height: 2.265em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.646em; vertical-align: -0.282em;"></span></span></div></span></div>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">对于该函数，省略<a href="http://www.cnblogs.com/allensun/archive/2011/02/16/1956532.html" style="background: transparent; margin-top: 0px;" target="_blank">推导过程</a>给出结论，如果给定 m 和 n，当 k 取以下值时，误判率 p 的值最小：</p>
<div style="margin: 20px 0; text-align: center;"><span style="margin-top: 0px;"></span><span><div style="white-space: nowrap; margin-top: 0px;"><span style="width: 14.824em; display: inline-block; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 12.324em; height: 0px; font-size: 120%; margin-top: 0px;"><span style="position: absolute; clip: rect(1.253em 1000.003em 3.455em -0.533em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral, Arial Unicode MS, serif, serif; font-size: 83%; font-style: normal; font-weight: normal; margin-top: 0px;">公</span></span></span></span><span><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral, Arial Unicode MS, serif, serif; font-size: 83%; font-style: normal; font-weight: normal; margin-top: 0px;">式</span></span></span></span><span style="font-family:STIXGeneral-Regular, serif;">1</span><span><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral, Arial Unicode MS, serif, serif; font-size: 83%; font-style: normal; font-weight: normal; margin-top: 0px;">：</span></span></span></span><span style="font-family:STIXGeneral-Italic, serif;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em; margin-top: 0px;"></span></span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.301em;">=</span><span style="font-family:STIXGeneral-Italic, serif; padding-left: 0.301em;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em; margin-top: 0px;"></span></span><span style="font-family:STIXGeneral-Italic, serif;">n</span><span style="font-family:STIXGeneral-Regular, serif;">2</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.241em;">⋅</span><span style="padding-left: 0.241em;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="padding-left: 0.122em; padding-right: 0.122em; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 0.896em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.967em 1000.003em 2.741em -0.533em); top: -3.211em; left: 50%; margin-left: -0.354em; margin-top: 0px;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">m</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; clip: rect(1.967em 1000.003em 2.741em -0.533em); top: -1.842em; left: 50%; margin-left: -0.235em;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">n</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; clip: rect(0.836em 1000.003em 1.253em -0.533em); top: -1.307em; left: 0.003em;"><span style="border-left-width: 0.896em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.003em; margin-top: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span></span></span></span></span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.301em;">=</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.301em;">0.7</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.241em;">⋅</span><span style="padding-left: 0.241em;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="padding-left: 0.122em; padding-right: 0.122em; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 0.896em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.967em 1000.003em 2.741em -0.533em); top: -3.211em; left: 50%; margin-left: -0.354em; margin-top: 0px;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">m</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; clip: rect(1.967em 1000.003em 2.741em -0.533em); top: -1.842em; left: 50%; margin-left: -0.235em;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">n</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; clip: rect(0.836em 1000.003em 1.253em -0.533em); top: -1.307em; left: 0.003em;"><span style="border-left-width: 0.896em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.003em; margin-top: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 2.289em; vertical-align: -0.925em;"></span></span></div></span></div>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">此时误判率 p 等于：</p>
<div style="margin: 20px 0; text-align: center;"><span style="margin-top: 0px;"></span><span><div style="white-space: nowrap; margin-top: 0px;"><span style="width: 20.896em; display: inline-block; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 17.384em; height: 0px; font-size: 120%; margin-top: 0px;"><span style="position: absolute; clip: rect(1.015em 1000.003em 3.455em -0.533em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral, Arial Unicode MS, serif, serif; font-size: 83%; font-style: normal; font-weight: normal; margin-top: 0px;">公</span></span></span></span><span><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral, Arial Unicode MS, serif, serif; font-size: 83%; font-style: normal; font-weight: normal; margin-top: 0px;">式</span></span></span></span><span style="font-family:STIXGeneral-Regular, serif;">2</span><span><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral, Arial Unicode MS, serif, serif; font-size: 83%; font-style: normal; font-weight: normal; margin-top: 0px;">：</span></span></span></span><span><span style="display: inline-block; position: relative; width: 1.67em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.967em 1000.003em 2.92em -0.592em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">p</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; top: -2.021em; left: 0.539em;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-size: 70.7%; font-family: STIXGeneral-Italic, serif; margin-top: 0px;">m</span><span style="font-size: 70.7%; font-family:STIXGeneral-Italic, serif;">i</span><span style="font-size: 70.7%; font-family:STIXGeneral-Italic, serif;">n</span></span></span><span style="display: inline-block; width: 0px; height: 2.265em;"></span></span></span></span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.301em;">=</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.301em;">(</span><span style="font-family:STIXGeneral-Regular, serif;">1</span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.241em;">−</span><span style="padding-left: 0.241em;"><span style="margin-top: 0px;"><span style="padding-left: 0.122em; padding-right: 0.122em; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.729em 1000.003em 2.741em -0.414em); top: -3.211em; left: 50%; margin-left: -0.235em; margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">1</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; clip: rect(1.729em 1000.003em 2.741em -0.533em); top: -1.842em; left: 50%; margin-left: -0.235em;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">2</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; clip: rect(0.836em 1000.003em 1.253em -0.533em); top: -1.307em; left: 0.003em;"><span style="border-left-width: 0.658em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.003em; margin-top: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span></span></span><span><span style="display: inline-block; position: relative; width: 0.777em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.729em 1000.003em 2.92em -0.533em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">)</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; top: -2.676em; left: 0.36em;"><span style="font-size: 70.7%; font-family: STIXGeneral-Italic, serif; margin-top: 0px;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em; margin-top: 0px;"></span></span><span style="display: inline-block; width: 0px; height: 2.265em;"></span></span></span></span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.301em;">=</span><span style="padding-left: 0.301em;"><span style="display: inline-block; position: relative; width: 1.432em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.729em 1000.003em 2.741em -0.533em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">2</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; top: -2.676em; left: 0.539em;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-size: 70.7%; font-family: STIXGeneral-Regular, serif; margin-top: 0px;">−</span><span style="font-size: 70.7%; font-family:STIXGeneral-Italic, serif;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em; margin-top: 0px;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.265em;"></span></span></span></span><span style="font-family:STIXGeneral-Regular, serif; padding-left: 0.301em;">=</span><span style="padding-left: 0.301em;"><span style="display: inline-block; position: relative; width: 3.753em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.67em 1000.003em 2.741em -0.533em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="font-family: STIXGeneral-Regular, serif; margin-top: 0px;">0.6185</span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span><span style="position: absolute; top: -4.402em; left: 2.801em;"><span style="margin-top: 0px;"><span style="margin-top: 0px;"><span style="padding-left: 0.122em; padding-right: 0.122em; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px; margin-top: 0px;"><span style="position: absolute; clip: rect(1.848em 1000.003em 2.443em -0.533em); top: -2.616em; left: 50%; margin-left: -0.235em; margin-top: 0px;"><span style="font-size: 50%; font-family: STIXGeneral-Italic, serif; margin-top: 0px;">m</span><span style="display: inline-block; width: 0px; height: 2.265em;"></span></span><span style="position: absolute; clip: rect(1.848em 1000.003em 2.443em -0.533em); top: -2.021em; left: 50%; margin-left: -0.176em;"><span style="font-size: 50%; font-family: STIXGeneral-Italic, serif; margin-top: 0px;">n</span><span style="display: inline-block; width: 0px; height: 2.265em;"></span></span><span style="position: absolute; clip: rect(0.836em 1000.003em 1.253em -0.533em); top: -1.188em; left: 0.003em;"><span style="border-left-width: 0.658em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.003em; margin-top: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.074em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.991em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 2.575em; vertical-align: -0.925em;"></span></span></div></span></div>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">公式1 和 公式2 是实现一个 BloomFilter 需要的理论支撑。</p>
<h2 style="font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 30px; margin-bottom: 20px; font-size: 30px;">3. 实现</h2>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">一个 BloomFilter 需要用户提供两个参数：</p>
<ol style="margin-top: 0; margin-bottom: 10px; line-height: 1.6;">
<li style="line-height: 1.6; margin-top: 0px;"><span style="display: inline-block; margin: 0; margin-top: 0px;"><span style="margin-top: 0px;"></span><span><span style="white-space: nowrap; margin-top: 0px;"><span style="width: 0.658em; display: inline-block; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 0.539em; height: 0px; font-size: 120%; margin-top: 0px;"><span style="position: absolute; clip: rect(1.967em 1000.003em 2.741em -0.533em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">n</span></span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.718em; vertical-align: -0.068em;"></span></span></span></span></span>，预计集合规模；</li>
<li style="line-height: 1.6;"><span style="display: inline-block; margin: 0; margin-top: 0px;"><span style="margin-top: 0px;"></span><span><span style="white-space: nowrap; margin-top: 0px;"><span style="width: 0.658em; display: inline-block; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 0.539em; height: 0px; font-size: 120%; margin-top: 0px;"><span style="position: absolute; clip: rect(1.967em 1000.003em 2.92em -0.592em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">p</span></span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.932em; vertical-align: -0.282em;"></span></span></span></span></span>，当元素个数达到 n 时，可以接受的误判率</li>
</ol>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">bit 数组长度 <span style="display: inline-block; margin: 0; margin-top: 0px;"><span style="margin-top: 0px;"></span><span><span style="white-space: nowrap; margin-top: 0px;"><span style="width: 0.955em; display: inline-block; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 0.777em; height: 0px; font-size: 120%; margin-top: 0px;"><span style="position: absolute; clip: rect(1.967em 1000.003em 2.741em -0.533em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">m</span></span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.718em; vertical-align: -0.068em;"></span></span></span></span></span> 和 hash 函数个数 <span style="display:inline-block;margin:0"><span style="margin-top: 0px;"></span><span><span style="white-space: nowrap; margin-top: 0px;"><span style="width: 0.598em; display: inline-block; margin-top: 0px;"><span style="display: inline-block; position: relative; width: 0.479em; height: 0px; font-size: 120%; margin-top: 0px;"><span style="position: absolute; clip: rect(1.729em 1000.003em 2.741em -0.533em); top: -2.557em; left: 0.003em; margin-top: 0px;"><span style="margin-top: 0px;"><span style="font-family: STIXGeneral-Italic, serif; margin-top: 0px;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em; margin-top: 0px;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.562em;"></span></span></span><span style="border-left-width: 0.004em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.004em; vertical-align: -0.068em;"></span></span></span></span></span> 在初始化时由上述两个公式计算而得。</p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">在爬虫项目中用了 BloomFilter 作为 url 的判重器，代码在<a href="http://gist.github.com/novoland/9277fe26b4ec91cb3ee6" style="background: transparent; margin-top: 0px;" target="_blank">这里</a>。其中 k 个 hash 函数是通过为 MD5 提供 k 个不同的 salt 构造的。实际使用中当集合规模为 500 万，误判率为万分之一时，所占空间仅为 11.5M。</p>
<h2 style="font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 30px; margin-bottom: 20px; font-size: 30px;">4. 其他技巧</h2>
<ol style="margin-top: 0; margin-bottom: 10px; line-height: 1.6;">
<li style="line-height: 1.6; margin-top: 0px;"><p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word; margin-top: 0px;">两个 BloomFilter 的交集、并集</p>
<pre style="overflow: initial; font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 14px; display: block; padding: 0; margin: 0 0 10px; line-height: 1.6; word-break: break-all; word-wrap: break-word; color: #333333; background-color: #f5f5f5; border: none; border-radius: 0; white-space: pre-wrap;" xml:space="preserve"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: inherit; padding: 1em; color: #f8f8f2; background-color: transparent; white-space: pre-wrap; border-radius: 0; display: block; background: #23241f; margin-top: 0px;">filter1 | filter2 == 并集
filter1 &amp; filter2 == 交集
</code></pre>
</li>
<li style="line-height: 1.6;"><p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word; margin-top: 0px;"><strong style="font-weight: bold; margin-top: 0px;"><code style="font-family: Menlo, Monaco, Consolas, Courier New, monospace; font-size: 90%; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: nowrap; border-radius: 4px; margin-top: 0px;">counting BloomFilter</code></strong></p>
<p style="margin: 0 0 10px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">传统 BloomFilter 只能添加元素，不能对元素计数，也无法删除元素。如果把底层数组的 bit 换成 int，就可以支持计数和删除动作。每次插入元素时，将对应的 k 个 int 加一；查询时，返回 k 个 int 的最小值；删除时，将对应的 k 个 int 减一。</p>
</li>
</ol>
</div>
</article> <!-- end #post__content -->

<div id="post__share">
  <a id="icon-twitter" class="fontello" href="https://twitter.com/intent/tweet?url=http://novoland.github.io/%E7%AE%97%E6%B3%95/2014/07/28/BloomFilter.html&text=BloomFilter" target="_blank"></a>
  <a id="icon-cc" class="fontello" href="http://creativecommons.org/licenses/by-nc-sa/3.0" target="_blank"></a>
  <a id="icon-weibo" class="fontello" href="http://v.t.sina.com.cn/share/share.php?url=http://novoland.github.io/%E7%AE%97%E6%B3%95/2014/07/28/BloomFilter.html&title=BloomFilter" target="_blank"></a>
</div> <!-- end #post__share -->

<div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink" target="_blank">Loading Disqus comments...</a>
</div> <!-- end #disqus_thread -->

<p id="copyright">Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;&nbsp;|&nbsp;&nbsp;Theme <a href="https://github.com/P233/3-Jekyll" target="_blank">3-Jekyll</a></p>
      </div> <!-- end #pjax -->
<!-- 
      <div id="post__toc-trigger">
        <div id="post__toc">
          <span id="post__toc-title">目录</span>
          <ul id="post__toc-ul"></ul>
        </div>
      </div> -->
    </div> <!-- end #post -->

    <button id="js-fullscreen"><span id="icon-arrow" class="fontello"></span></button>
    <button id="js-toc"><span id="icon-list" class="fa fa-list-ul"></span></button>
    <div id="post__toc">
      <span id="post__toc-title">目录</span>
      <ul id="post__toc-ul"></ul>
    </div>

    <script src="/assets/js/jquery-2.0.3.min.js"></script>
    <script src="/assets/js/jquery.pjax.js"></script>
    <script src="/assets/js/nprogress.js"></script>
    <script src="/assets/js/script.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>
