---
layout: post
title: 声音设计
tags: ui
category: ui
---

无论声音是你 app 体验不可或缺的部分,还是仅仅只是偶尔用来增强效果,你都需要了解用户对声音行为有何期望 并如何满足他们的期望。##理解用户期望
人们可以使用设备控件调节声音,也可能会使用有线或无线的耳机。他们也对用户行为如何影响其所听到的声音有各 种期望。虽然你可能感觉其中一些期望很奇怪,但它们都遵循用户控制的原则——是用户而不是设备来决定什么时候 听到声音是合适的。
当用户想要以下结果时会将设备切换到静音:
-  避免被不符合期望的声音打断,例如电话铃声和新消息的提醒声音
- 免听到由用户操作所产生的声音,例如键盘声音,其他反馈声音,故障声音或者应用启动声音
- 避免在玩游戏时听到不相关的声音,例如偶然的故障声音		注意:在 iPhone 上,人们可以通过切换「响铃/静音模式」将设备转为静音;在 iPad 上,则可以开启「静音模 式」。

例如,在剧院中用户想将设备调成静音,以避免打扰剧院中的其他听众。在这种情况下,用户仍然想要能够在他们的 设备上使用 app ,但不想被突然的声音所吓到,例如铃声或新消息声音。

对于用户特别设置的声音,「响铃/静音模式」(或「静音模式」)并不能关闭它们。例如:

-   在多媒体播放器中的媒体播放不能被静音,因为它是由用户主动明确请求的。
-   「时钟」中的闹钟不会静音,因为它是由用户明确设置的。
-    在语言学习应用中的声音片段不应被静音,因为用户做出了明确操作想听到它。
-     在语音聊天应用中的对话不应被静音,因为用户启动它目的就是为了能够语音聊天。<b>用户用系统的音量键可以调整设备播放的所有声音</b>,包括歌曲、应用声音和设备声音。无论处于「响铃/静音模式」的 哪一挡上,用户都可以使用音量键静音。使用音量键调节 app 当前播放的音频,也可以调节整个系统的声音,铃声 音量除外。
		iPhone:在没有音频播放时,使用音量键是调节铃声音量。
		
<b>用户使用耳机和耳塞来私密地收听声音,这还解放了他们的双手.</b>无论这些配件是有线还是无线连接,用户对其用户体验都有特殊的期望。

无论这些配件是有线还是无线连接,用户对其用户体验都有特殊的期望。当用户拔出耳机,断开无线设备(又或者,设备超出范围或关机),他们不想把刚才听到的声音自动地共享给其他 人。所以,用户期望正在播放音频的程序可以暂停,等到准备好了允许它们重新播放。基于这个原因,他们期望正在 播放音频的 app 能够暂停,并在他们准备就绪时允许他们重新播放。
###定义应用的声音行为
<b>如果需要,你可以调节相对独立的音量水平以使 app 输出最好的混响声音。</b>无论你是通过音量按键还是音量滑块调 节音量,最终音频输出的音量应该受系统音量管制。这意味着对 app 音频输出的控制权仍然在用户手中。
<b>如果合适的话,确保你的 app 能够展示音频线路选择器。音频线路(audio route)</b>是音频信号的电子通道,例如 从一台设备到耳机或者从一台设备到麦克风。)即使用户不能插入或者拔出一个无线音频设备,他们仍然期望能够选 择一个不同的音频路线。为了解决这个问题,iOS 会自动地展示一个控件允许用户选择一个音频输出路线(使用 MPVolumeView 类以在你的 app 中展现这个控件)。由于选择不同的音频路线是用户发起的行为,用户期望当前播 放的音频无需暂停就能继续播放。<b>如果你需要展示音量滑块,</b>如果你需要展示音量滑块,<b>如果你的 app 只是在界面的某些功能中附带音效,请使用 System Sound Services。</b>System Sound Services 是一种在 iOS 中呈现警告和 UI 音效并调用振动的技术,但并不适用于其他目的。当你使用 System Sound Services 来呈现音效时,你不能决定你的声音会如何与设备中其他的声音交互,或它会如何响应中断和设备配置的 变化。如需了解如何使用这种技术的示例项目,请参阅 《Audio UI Sounds(SysSound)》。<b>如果声音在你的 app 中扮演一个很重要的角色,使用 Audio Session Services</b>或者 AVAudionSession 􏰀。 这些程序接口不会直接呈现声音,相反,它们帮助你的声音如何与设备中的声音配合,并响应中断和设备配置的变 化。
	iPhone:无论你使用何种技术呈现声音,如何定义它的行为,电话总是能够打断当前运行的 app。
	这是因为没有 app 应当阻止人们接听来电。在 Audio Session Servies 中,<strong>音频会话</Strong>(audio session)是你的 app 和系统之间的调节者。音频会话中最重要 的一方面是类别(category),其定义了你 app 的声音行为。为获得 Audio Session Services 的好处和提供用户所期待的声音体验,你需要选择和你的 app 行为最相符的分 类。这取决于你的 app 是只在前台播放声音还是也能在后台播放。请遵循以下准则做出选择:
- 选择音频会话类别要基于其语意上的意义。选择一个目的明确的类别,这会确保你的 app 行为符合用户期望。 此外,如果将来重新定义了具体的行为,这也给你的 app 一个绝佳机会使其正常运转。
- 在少数情况下,给音频会话添加一个属性以修改类别的标准行为。一个类别的标准行为代表着大部分用户所期 望的样子,因此在修改其行为前你应当认真考量。例如,为了确保你的声音比其他声音大(电话铃声除外), 你可能会添加一个下沉(ducking)属性,以便符合用户对你 app 的预期。(如需了解更多关于音频会话属性 的内容,请参阅《Audio Session Programming Guide》中「Fine-Tuning the Category」一节。)
-  考虑基于当前设备的音频环境来选择你的类别。这可能会有用,例如,用户可以一边听其他音频一边使用你的 app,而不会被你的音轨打断。如果你这样做,请确保在你的 app 启动时不要强制用户暂停他们的音乐或者做 出明确的音轨选择。
- 通常来说,避免在你的 app 运行时改变类别。可能改变类别的最大原因是你的 app 需要在不同时候支持录制 和回放。在这种情况下,比起选择播放和录音(Play and Record)类别,根据需要在录音(Record)和回放 (Playback)类别中切换确实会更好。这是因为选择录音(Record)类别能确保在录制过程中不会有提醒 (如新消息提醒)会发出声音。
表30-1 列出了你可以使用的音频会话类别。不同的类别允许使用「响铃/静音」模式或者「静音」模式(或设备锁 屏)将声音静音,和其他音频混响,或者在 app 处于后台时播放。(如需了解在程序接口中出现的具体分类和属性 名称,请参阅《Audio Session Programming Guide》。)
表30-1 音频会话类别及其相关行为
<table align="center" border="1">
<tr bgcolor="lightblue">
   <td>
	类别
   </td>
    <td>
	含义
   </td>
    <td>
	是否静音
   </td>
    <td>
	混响
   </td>   
    <td>
	是否在后台
   </td>   
</tr>
<tr>
   <td>独奏环境(Solo Ambient)</td>
   <td>声音会提升 app 的功能效 果,并应把其他音频静音</td>
   <td>
	是
   </td>
   <td>
   否
   </td>
   <td>
   否
   </td>
</tr>
<tr>
   <td>环境(Ambient)</td>
   <td>声音会提升 app 的功能效 果,但并不把其他音频静音。</td>
   <td>是</td>
   <td>是</td>
   <td>否</td>
</tr>
<tr>
   <td>回放(Playback)</td>
   <td>声音作为 app 功能必不可少 的部分,并且可能会和其他音 频混响。</td>
   <td>否</td>
   <td>否(默认),是(在 Mix With Others 属性被添加 时)</td>
   <td>是</td>
</tr>
<tr>
   <td>录音(Record)</td>
   <td>音频是由用户录制的。</td>
   <td>否</td>
   <td>否</td>
   <td>是</td>
</tr>
<tr>
   <td>播放和录音(Play and Record)</td>
   <td>声音呈现为音频输入和输出,两者循序或同时进行</td>
   <td>否</td>
   <td>否(默认),是(在 Mix With Others 属性被添加 时)</td>
   <td>是</td>
</tr>
<tr>
   <td>音频处理(Audio Processing)</td>
   <td>App 执行硬件辅助的音频解码 (并非播放和录音)。</td>
   <td>是/否</td>
   <td>否</td>
   <td>是*</td>
</tr>
</table>

如果你选择了 Audio Processing 类别并在后台执行音频处理,你需要在完成音频处理之前防止你的 app 停止运 行。如需了解如何实现,请参阅《iOS App Programming Guide》中「Implementing Long-Running Background Tasks」一节。####这里有一些场景,描述了如何选择音频会话类别以提供用户所赞赏的声音体验:
场景 1:一款帮助用户学习新语言的教育类 app。你需要:
- 在用户轻点特殊控件时,播放反馈声音
- 在用户想要听正确的发音示例时,播放事先录制的单词和词汇
在这个 app 中,声音作为主要功能必不可少。用户使用这个 app 来听所学语言的单词和词汇,因此即使是在设备锁 屏或者切换为静音时都应当发出声音。由于用户需要听到清晰的发音,他们期望其他正在播放的声音都静下来。
为了在这个 app 中提供用户期待的声音体验,你需要使用回放(Playback)类别。尽管这个类别稍加修改后可以支 持和其他音频混响,但这个 app 应当使用默认行为,以确保其他音频不会和用户确切选择的教育内容相冲突。场景 2:一款 VoIP 电话 app。你需要提供:
-  接收音频输入的能力
-  播放音频的能力
在这个 app 中,声音作为主要功能必不可少。用户在用这个 app 和其他人通话时,往往正在使用其他 app。他们期 望在切换设备到静音或者锁屏时仍然能够接听电话,并希望在通话过程中其他音频保持安静。用户同样希望当 app 在后台运行时仍然能够接听电话。
为了在 app 中提供所期待的用户体验,你应当使用播放和录音(Play and Record)类别。另外,你需要确保只在 需要时激活音频会话,以便用户可以在不通话时使用其他声音。
场景 3:一款允许用户操作角色完成不同任务的游戏。你需要提供:- 各种游戏音效-  一个音乐音轨
在这个 app 中,声音会显著提升用户体验,但对于主要任务并不是必须的。同时,用户很容易欣赏可以将游戏静 音,或是在听他们乐库中的音乐时替换游戏原声的做法。
最好的策略是在你的 app 启动时看看用户是不是在听其他音频。不要让用户选择他们是想听其他音频还是你的原 声。反而,调用 Audio Session Services 的函数 AudioSessionGetProperty 去读取 kAudioSessionProperty_OtherAudioIsPlaying 的值。基于这个值,你可以选择环境(Ambient)或者独奏 环境(Solo Ambient)类别(两者均允许用户让游戏静音):
- 若用户正在听其他音频,你应该假设他们更希望继续听,对强制播放游戏原声以替代的做法并不喜欢。这种情 况下,你可以选择环境(Ambient)类别。- 若用户在你的 app 启动时没有听其他音频,你可以选择独奏环境(Solo Ambient)类别。
场景 4:一款提供准确实时导航,指引用户到达目的地的 app。你需要提供:

- 为行程中每一步语音提示方向- 一些反馈声音
-  可以让用户继续听他们音频的能力

在这个 app 中,无论它是否在后台,语音导航指令都是其最主要的任务。基于此,你应当使用回放(Playback)类 别,它允许你在设备锁屏、切换为静音或者你的 app 在后台运行时播放声音。为了让用户在使用你的 app 时听其他音频,你可以添加 kAudioSessionProperty_OverrideCategoryMixWithOthers 属性。无论如何,你也想要确保用户在他们当 前播放的声音智商听到语音指令。为了做到这样,你可以在音频会话中使用 kAudioSessionProperty_OtherMixableAudioShouldDuck 属性,以确保你的音频比所有当前播放的音频都 大声(iPhone 上的电话声音除外)。这些设置允许 app 在后台运行时重新激活音频会话,这确保用户可以实时获知 导航变更。

>场景 5:一款允许用户往网站上传文字和图片的博客 app。你需要提供
-  简短的启动乐
- 各种伴随用户操作的简短音效(例如在成功上传一篇日志后播放的效)
-  在发布失败时的警告音
在这个 app 中,声音可以提升用户体验,但不是必需的。主要任务与声音无关,用户页不需要听到任何声音就能成 功使用 app。在这种情况下,你可以使用 System Sound Services 以生成声音。由于 app 中所有的声音内容都要 和此 app 的既有目的相符,播放的 UI 音效和警告音需要如用户期待那样,服从于设备锁屏和「响铃/静音」(或 「静音」)模式。
###管理音频中断
某些时候,正在播放的声音会被其他 app 的声音打断。例如,在 iPhone 中接听一个来电的时间段里会中断当前 app 的声音。在多任务环境中,这样的声音中断频率会很高。
为提供用户所喜欢的声音体验,iOS 需要你:
- 确定你的 app 会导致的音频中断类型
-  在音频中断结束后合适地响应
每个 app 都需要确定其可能导致的音频中断类型,但不是每一个 app 都需要决定在一段音频中断结束后如何响应。 因为大部的 app 都应当在一段音频中断后恢复声音。只有以多媒体回放为主的 app,那些提供多媒体回放控件的 app 需要采取额外的步骤以决定恰当的响应。
从概念上来说,基于中断的声音类型和用户对中断结束后的期望,这里有两种音频中断类型:
-  可恢复的中断,是由一段用户认为是其主要聆听体验的插曲的音频导致的。在一段可恢复的中断结束后,有回放控件的 app 应该恢复到中断发生时的状态,无论当时是正在播放还是处于 暂停。没有回放控件的 app 应该恢复到播放状态。例如,设想一位用户正用 iPhone 听音乐,突然在听到一半时来了一个 VoIP 电话。他接了电话,期望播放 app 在通话期间保持静音。通话结束后,用户希望播放 app 能自动恢复到正在播放的歌曲,因为音乐是他们首 要的聆听体验,在来电时不得不将音乐停止。从另一方面来说,如果用户在收到来电前已经将音乐停止,通话 结束后他们仍然希望音乐继续保持暂停。
其他可能会导致可恢复中断的 app 方面的例子,例如播放闹铃、声音指示(例如语音驾驶导航)或其他间歇音 频方面的 app。
- 不可恢复的中断,由用户视为主要聆听体验的音频引起,例如一个多媒体播放 app 的声音。在一段不可恢复的中断结束后,有回放控件的 app 不应当回复音频播放。没有回放控件的 app 应当恢复音频播放。
例如,设想一位用户正在使用一个音乐播放 app(第 1 个音乐 app)时,被另一个音乐播放 app(第 2 个音 乐 app)打断了。作为响应,用户决定继续听一会儿第 2 个音乐 app。在退出第 2 个音乐 app 后,用户不会 希望自动恢复第 1 个音乐 app 的播放,因为用户已主动将第 1 个音乐 app 视为他们的主要聆听体验。
以下准则会帮助你决定提供哪些信息以及在一段音频中断结束后如何继续:
确定 app 导致的音频中断类型。你在你的音频播放完毕后通过以下两种方式结束你的音频:
- 如果你的 app 导致了可恢复的中断,通过 AVAudioSessionSetActiveFlags_NotifyOthersOnDeactivation 标记来结束音频会话。
- 如果你的 app 导致了不可恢复的中断,不要用任何标记(flag)来结束音频会话。
无论提供与否,在合适情况下,标记(flag)会让 iOS 赋予被打断的 app 以自动恢复音频播放的能力。在音频中断结束后决定是否应该恢复播放。你可以根据在你的 app 中所提供的音频体验做出决定。
- 如果你的 app 有回放控件可供用户用于播放或暂停音频,你需要在音频中断结束后检查 AVAudioSessionInterruptionFlags_ShouldResume 标记。

	如果你的 app 收到了 Should Resume 标记,你应当:
	
	-  若你的 app 在播放音频时被打断,恢复音频播放
	- 在你的 app 没有播放音频时被打断,无需回复音频播放
	
- 如果你的 app 没有显示任何用户可以用来播放或暂停的多媒体播放控件,在音频中断结束后你通常应当恢复音 频播放,无论 Should Resume 标记是否出现。	
	 例如,一个会播放背景音乐的游戏应当在中断结束后自动地回复之前正在播放的背景音乐。	
##合适地处理远程多媒体控制事件在人们使用 iOS 多媒体控件或辅助控件——例如耳机控件时,app 可以接受远程控制事件。这让你的 app 可以接受 用户没有经由你界面的指令,无论你的 app 是正在前台还是后台播放音频。	
App 可以发送视频到支持 AirPlay 的设备——例如 Apple TV——并在挂到后台的同时继续播放。这样一个可以接受 用户通过远程控制事件输入的 app,在其处于后台时,用户也可以控制视频播放。此外,这种类型的 app 还可以在 中断结束后在后台重新激活音频会话。多媒体播放 app,尤其需要适当响应多媒体远程控制事件,特别实在其播放音频或处于后台时。
为满足和你的 app 可以在后台播放多媒体内容这一特权相符的责任,请确保遵循以下准则:
<strong>让你的 app 只在适当的时候接受远程控制事件。</strong>例如,如果你的 app 是帮助用户阅读内容,搜索信息,或者聆听音 频,它应当只在用户处于音频情境时才接受远程控制事件。当用户离开音频情境,你应当放弃接受事件的能力。若你 的 app 让用户可以在支持 AirPlay 的设备上播放音频或视频,它应只在播放期间接受远程控制事件。当用户在你的 app 中处于非多媒体情境时,遵循这些准则可以让他们消费另一个 app 的多媒体内容——并用耳机操控。
<strong>尽可能使用系统控件以提供 AirPlay 支持。</strong>当你在使用 MPMoviePlayerController 类去支持 AirPlay 播放时, 你可以利用标准控件的优势让用户选择一个当前范围内支持 AirPlay 的设备。或者你可以使用 MPVolumeView 类以 显示用户可以选择的支持 AirPlay 的音频或视频设备。用户习惯了标准控件的样式和行为,所以他们会知道在你的 app 中如何使用它们。
<strong>不要改变一个事件的用途,即使它在你的 app 中没有任何意义。<strong>用户期望 iOS 的多媒体控件和辅助控件在所有 app 中保持功能上的一致性。你不需要处理你的 app 用不上的事件,但你处理的事件一定要达到用户所期望的结果。如 果你要重新定义事件的含义,你会混淆用户并冒险地讲他们带到一种未知的境地,除了退出你的 app,他们没有其他 办法。	