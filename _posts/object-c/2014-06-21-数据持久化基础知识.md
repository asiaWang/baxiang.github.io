---
layout: post
title: 极火IOS——4种数据持久化方法
tags: object-c
category: object-c
---

IOS应用程序采用沙盒原理设计，IOS每个应用程序都有自己的3个目录:
朱蒙
- Documents : 应用程序将数据存储在Documents中，但基于NSUserDefaults的首选项设置除外

- Library   : 基于NSUserDefaults的首选项设置存储 在Library/Preference文件中。

- tmp  	    : tmp目录供应用程序存储临时文件，当IOS设备执行同步时，iTunes不会备份tmp中的文件，但在不需要这些文件的时候，应用程序负责删除tmp中的文件，以免占用文件系统的空间。


###1.属性列表

属性列表无法保存自定义对象 



###2.对象归档

- 概念：对象归档是指将对象写入文件保存在硬盘上，当再次重新打开程序时，可以还原这些对象。可称为对象序列化，对象持久化

{% highlight objective-c linenos %}
	
	//归档（序列化）
	NSString *homeDirectory = NSHomeDirectory();         //拿到根路径		
	NSArray *array = @ [@123,@456,@"999",@"0000"];
	NSString *directoryA = [homeDirectory stringByAppendingPathComponent:@"array.archive"];
	if([NSKeyedArchiver archiveRootObject:array toFile:directoryA]){
		NSLog(@"archiver success");
	}
	
	//解归档 （反序列化）
	NSArray *unArray = [NSKeyedUnarchiver unarchiveObjectWithFile:directoryA];
	NSLog(@"new Array: %@",newArray);
	
{% endhighlight %}	

### 自定义内容归档
 
 （1） 归档
	
* 使用NSData实例作为归档的存储数据
* 添加归档的内容（设置key与value）
* 完成归档
* 将归档数据存入磁盘中
	
{% highlight objective-c linenos %}
	
	//归档
	NSString *homePath = NSHomeDirectory();
	NSString *filePath = [homePath stringByAppendingPathComponent:@"custom.arc"];
	NSMutableData *data = [NSMutableData data];
	NSKeyedArchiver *archiver =[[NSKeyedArchiver alloc]initForWritingWithMutableData: data];
	[archiver encodeFloat50 forKey:@"weight"]; 
	
	
{% endhighlight %}	

（2） 解归档

* 从磁盘读取文件，生成NSData实例
* 根据Data实例创建和初始化归档实例
* 解归档，根据key访问value的值	

{% highlight objective-c linenos %}
  
    //解归档
        NSString *homePath = NSHomeDirectory();
        NSString *filePath = [homePath stringByAppendingPathComponent:@"custom.arc"];
        NSData *content = [NSData dataWithContentsOfFile:filePath];
        NSKeyedUnarchiver *unarchiver = [[NSKeyedUnarchiver alloc]initForReadingWithData:content];
        float weight = [unarchiver decodeFloatForKey:@"weight"];
        NSString *name = [unarchiver decodeObjectForKey:@"name"];
        NSLog(@"%0.f %@",weight,name);

{% endhighlight %}	

##自定义对象的归档

- 自定义对象需要支持归档，需要实现NSCoding协议

- NSCoding 协议有两个方法，encodeWithCoder方法对对象的属性数据做编码处理，initWithCoder解码归档数据来初始化对象

- 实现NSCoding协议后，就能通过NSKeyedArchiver归档。
 

###3.SQLite3

 
 
###4.Core Data