
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>小巴童鞋</title>
	<meta name="author" content="小巴">

	
	<meta name="description" content="ios iOS应用程序安全(20)-本地数据存储及其安全性（NSUserDefaults, CoreData, Sqlite, Plist 文件） 作者：Prateek Gianchandani
译者：吴发伟
原文网址：http://resources.infosecinstitute.com/ &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="小巴童鞋" type="application/atom+xml">
	
	<link rel="canonical" href="http://baxiang123.com//posts/2/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="http://cdn.staticfile.org/jquery/1.9.1/jquery.min.js"></script>
	<link href="/stylesheets/google-fonts.css" rel="stylesheet" type="text/css">
	
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		document.write("<img src='/images/xiaoba.png" + "?s=160' alt='Profile Picture' style='width: 160px;' />");
	</script>
</div>
<h1>&nbsp;&nbsp;<a href="/">小巴童鞋</a></h1>
<p class="subtitle">Xiaoba&#8217;s technology blog</p>
<nav id="main-nav"><ul class="main">
    <li><a href="/">主页 Blog</a></li>
    <li><a href="http://about.me/shashankmehta">关于 About</a></li>
    <li><a href="/blog/archives">归档 Archives</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="weibo" href="http://www.weibo.com/1655203353" title="Weibo">Weibo</a>
		
		
		<a class="facebook" href="http://www.facebook.com/xiang.ba.1" title="Facebook">Facebook</a>
		
		
		
		<a class="twitter" href="http://twitter.com/baxiang2014" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/baxiang" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>

</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-16T00:00:00+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>ios</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/16/ios-application-security-20/" itemprop="url">iOS应用程序安全(20)-本地数据存储及其安全性（NSUserDefaults, CoreData, Sqlite, Plist 文件）</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>作者：Prateek Gianchandani<br/>
译者：吴发伟<br/>
原文网址：<a href="http://resources.infosecinstitute.com/ios-application-security-part-20-local-data-storage-nsuserdefaults-coredata-sqlite-plist-files/">http://resources.infosecinstitute.com/ios-application-security-part-20-local-data-storage-nsuserdefaults-coredata-sqlite-plist-files/</a><br/>
版权声明：自由转载-非商用-保持署名</p>

<p>本文我们将看看应用在本地存储数据有哪些方法以及这些不同方法的安全性。</p>

<p>我们将会在一个demo上这些这些测试，你可以从我的<a href="https://github.com/prateek147/localDataStorageDemo">github</a>账号上下载这个例子程序。对于CoreData的例子，你可以从<a href="https://github.com/ChrisDrit/Core-Data-Example-Code">这</a>下载例子程序。本例有一个不同点就是我们将会在模拟器上运行这些应用，而不是在设备上运行。这样做的目的是为了证明在前面文章中的操作都可以通过Xcode来把这些应用运行在模拟器上。当然，你也可以使用<a href="http://wufawei.com/2013/11/ios-application-security-7/">前面文章中的步骤</a>把这应用安装到设备上。</p>

<p><br></p>

<h2>NSUserDefaults</h2>

<p>保存用户信息和属性的一个非常普通的方法就是使用NSUserDefaults。保存在NSUserDefaults中的信息在你的应用关闭后再次打开之后依然存在。保存信息到NSUserDefaults的一个例子就是保存用户是否已登录的状态。我们把用户的登录状态保存到NSUserDefaults以便用户关闭应用再次打开应用的时候，应用能够从NSUserDefaults获取数据，根据用户是否登录展示不同的界面。有些应用也用这个功能来保存机密数据，比如用户的访问令牌，以便下次应用登录的时候，它们能够使用这个令牌来再次认证用户。</p>

<p>从我的<a href="https://github.com/prateek147/localDataStorageDemo">github</a>可以下载例子应用，运行起来。你可以得到下面的界面，现在输入一些信息到与NSUserDefaults相关的文本框，然后点击下面的“Save in NSUserDefaults”。这样数据就保存到NSUserDefaults了。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/101613_1214_IOSApplicat1.png" alt="" /></p>

<p>许多人不知道的是保存到NSUserDefaults的数据并没有加密，因此可以很容易的从应用的包中看到。NSUserDefaults被存在一个以应用的bundle id为名称的plist文件中。
首先，我们需要找到我们应用的bundle id。因为我们在模拟器上运行，我们可以在/Users/$username/Library/Application Support/iPhone Simulator/$ios version of simulator/Applications/找到应用。我这的路径是：“Users/prateekgianchandani/Library/Application Support/iPhone Simulator/6.1/Applications”。</p>

<p>一旦我们找到那个目录，我们可以看到一堆应用。我们可以用最近修改的日期找到我们的应用，因为它是最近修改的。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/101613_1214_IOSApplicat2.png" alt="" /></p>

<p>进入到应用的bundle里面。通过NSUserDefaults保存的数据都可以在如下图所示的Library -> Preferences -> $AppBundleId.plist文件中找到。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/101613_1214_IOSApplicat3.png" alt="" /></p>

<p>打开这个plist文件，我们可以清楚的看到这个文件的内容。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/101613_1214_IOSApplicat4.png" alt="" /></p>

<p>有时候，plist文件会以二进制格式保存，因此可能第一下看到会觉得不可读。你可以用plutil工具把它转成xml格式，或者直接用iExplorer在设备上查看。</p>

<p><br></p>

<h2>Plist 文件</h2>

<p>另一种保存数据普遍用的方法就是plist文件。<strong>Plist文件应该始终被用来保存那些非机密的文件，因为它们没有加密，因此即使在非越狱的设备上也非常容易被获取</strong>。已经有<a href="http://garethwright.com/facebook-mobile-ecurity-hole-allows-identity-theft/">漏洞</a>被爆出来，大公司把机密数据比如访问令牌，用户名和密码保存到plist文件中。在下面的demo中，我们输入一些信息并保存到plist文件。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/101613_1214_IOSApplicat5.png" alt="" /></p>

<p>下面是把数据保存到plist文件的代码。</p>

<pre><code>[plain]
NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory,NSUserDomainMask,YES);
NSString *documentsDirectory = [paths objectAtIndex:0];
NSString *filePath = [documentsDirectory stringByAppendingString:@"/userInfo.plist"];
NSMutableDictionary* plist = [[NSMutableDictionary alloc] init];
[plist setValue:self.usernameTextField.text forKey:@"username"];
[plist setValue:self.passwordTextField.text forKey:@"passwprd"];
[plist writeToFile:filePath atomically:YES];
[/plain]
</code></pre>

<p>如你所见，我们能够给plist文件指定路径。我们可以搜索整个应用的所有plist文件。在这里，我们找到一个叫做userinfo.plist的文件。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/101613_1214_IOSApplicat6.png" alt="" /></p>

<p>可以看到，它包含了我们刚刚输入的用户名/密码的组合。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/101613_1214_IOSApplicat7.png" alt="" /></p>

<p><br></p>

<h2>CoreData和Sqlite文件</h2>

<p>因为CoreData内部使用Sqlite来保存信息，因此我们这里将只会介绍下CoreData。如果你不知道什么是CoreData，下面是从苹果文档介绍CoreData截的图。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/101613_1214_IOSApplicat8.png" alt="" /></p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/101613_1214_IOSApplicat9.png" alt="" /></p>

<p>因此，基本上，CoreData可以用来创建一个model，管理不同对象的关系，把数据保存到本地，然后当你查询的时候从本地缓存中获取它们。本例中，我们将使用一个demo，位于<a href="https://github.com/ChrisDrit/Core-Data-Example-Code">github</a>。运行起来，你会发现它只是一个简单的RSS feed。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/101613_1214_IOSApplicat10.png" alt="" /></p>

<p>这个应用用CoreData保存数据。一个非常重要的一点就是CoreData内部使用sql，因此所有文件都以.db文件保存。我们到这个app的bundle中去看看。
在这个app的bundle中，你可以看到那里有一个MyCoreData.sqlite的文件。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/101613_1214_IOSApplicat11.png" alt="" /></p>

<p>我们可以用sqlite3分析。我这slite文件的地址是：~/Library/Application Support/iPhone Simulator/6.1/Applications/51038055-3CEC-4D90-98B8-A70BF12C7E9D/Documents.</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/101613_1214_IOSApplicat12.png" alt="" /></p>

<p>我们可以看到，这里有个叫做ZSTORIES的表。在Core Data中，每个表名开头都会被追加一个Z。这意味着真正的实体名称是STORIES，如我们在工程的源码文件看到的那样。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/101613_1214_IOSApplicat13.png" alt="" /></p>

<p>我们可以非常容易的导出这个表的所有值。请却表headers的状态是on。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/101613_1214_IOSApplicat14.png" alt="" /></p>

<p>正如我们看到的那样，默认的，保存在CoreData的数据都是没有加密的，因此可以轻易的被取出。因此，我们不应该用CoreData保存机密数据。
有些库包装了一下CoreData, 声称能够保存加密数据。也有些库能够把数据加密保存到设备上，不过不使用CoreData。例如，Salesforce Mobile SDK
就使用了一个被称为<a href="http://www.modelmetrics.com/tomgersic/storing-data-offline-with-salesforce-mobile-sdk-smartstore/">SmartStore</a>的功能来把加密数据以&#8221;Soups&#8221;的形式保存到设备上。</p>

<p><br></p>

<h2>Keychain</h2>

<p>有些开发者不太喜欢把数据保存到Keychain中，因为实现起来不那么直观。<strong>不过，把信息保存到Keychain中可能是非越狱设备上最安全的一种保存数据的方式了</strong>。<strong>而在越狱设备上，<a href="http://wufawei.com/2013/11/ios-application-security-12/">没有任何事情</a>是安全的。</strong><a href="http://highaltitudehacks.com/2013/09/17/ios-dev-storing-info-in-keychain-with-nsuserdefaults-like-syntax">这篇文章</a>展示了使用一个简单的wrapper类，把数据保存到keychain是多么的简单。使用这个wrapper来保存数据到keychain就像把数据保存到NSUserDefaults那么简单。下面就是一段把字符串保存到keychain的代码。请注意和使用NSUserDefaults的语法非常类似。</p>

<pre><code>[plain]
PDKeychainBindings *bindings = [PDKeychainBindings sharedKeychainBindings];
[bindings setObject:@"XYZ" forKey:@"authToken"];
[/plain]
下面是一段从keychain中取数据的代码。

[plain]
PDKeychainBindings *bindings = [PDKeychainBindings sharedKeychainBindings];
NSLog(@"Auth token is %@",[bindings objectForKey:@"authToken"]]);
[/plain]
</code></pre>

<p><br></p>

<h2>一些小技巧</h2>

<p>正如之前讨论过的那样，没有任何信息在越狱设备上是安全的。攻击者能够拿到Plist文件，导出整个keychain，<a href="http://wufawei.com/2013/11/ios-application-security-8/">替换</a>方法实现，并且攻击者能做他想做的任何事情。<strong>不过开发者能够使用一些小技巧来使得脚本小子从应用获得信息变得更难。</strong>比如把<strong>文件加密</strong>放到本地设备上。<a href="http://highaltitudehacks.com/2013/09/26/ios-dev-encrypted-images-and-saving-them-in-app-sandbox">这里</a>这篇文章详细的讨论了这一点。或者你可以<strong>使得攻击者更难理解你的信息</strong>。比如考虑要把某个用户的认证令牌（authentication token）保存到keychain当中，脚本小子可能就会导出keychain中的这个数据，然后试图劫持用户的会话。我们只需再把这个认证令牌字符串<strong>反转</strong>一下（reverse），然后再保存到keychain中，那么攻击者就不太可能会知道认证令牌是反转保存的。当然，攻击者可以追踪你的应用的每一个调用，然后理解到这一点，但是，<strong>一个如此简单的技术就能够让脚本小子猜足够的时间，以至于他们会开始寻找其它应用的漏洞</strong>。另一个<strong>简单技巧</strong>就是在每个真正的值保存之前<strong>都追加一个常量字符串</strong>。</p>

<p>在接下来的文章里，我们将讨论使用GDB进行运行时分析。</p>

<p> <br/>
本文原文 <a href="http://resources.infosecinstitute.com/ios-application-security-part-20-local-data-storage-nsuserdefaults-coredata-sqlite-plist-files/">IOS Application Security Part 20 – Local Data Storage (NSUserDefaults, CoreData, Sqlite, Plist files)</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-16T00:00:00+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>ios</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/16/ios-application-security-19/" itemprop="url">iOS应用程序安全(19)-在程序中使用Introspy</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>作者：Prateek Gianchandani<br/>
译者：吴发伟<br/>
原文网址：<a href="http://resources.infosecinstitute.com/ios-application-security-part-19-programmatical-usage-of-introspy/">http://resources.infosecinstitute.com/ios-application-security-part-19-programmatical-usage-of-introspy/</a><br/>
版权声明：自由转载-非商用-保持署名</p>

<p>在本文当中，我们将看看如何在我们自己的脚本中使用Introspy这个模块。</p>

<p>第一件事情就是引入Introspy模块，然后从argparse模块中引入Namespace。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/093013_1617_IOSApplicat1.png" alt="" /></p>

<p>然后我们创建Introspy类的实例。我们需要提供数据库名、组名、子组名和列表作为参数。在这里，除了数据库地址之外，我们为其他所有参数提供None。
因此，Introspy会包含所有的组而不是仅包含某个特定的组。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/093013_1617_IOSApplicat2.png" alt="" /></p>

<p>现在让我们创建一个带有组(group)和子组(subgroup)的对象。但是，我在文档中找不到组和子组的不同类目，不过从我们在前面文章中Introspy
生成的HTML报告中，我能找到组和子组的列表。看下图，所有的主要菜单项都可以用来作为组名称，而所有的子菜单项都可以用来作子组名称。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/093013_1617_IOSApplicat3.png" alt="" /></p>

<p>所以，例如，组名可以为DataStorage，Crypto, Network，IPC等等，Network的子组名可以为HTTP。现在让我们创建一个Introspy对象，组为Netwrok,
子组为HTTP。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/093013_1617_IOSApplicat4.png" alt="" /></p>

<p>现在看看这个introspy对象的所有方法和属性。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/093013_1617_IOSApplicat5.png" alt="" /></p>

<p>如我们所见，这个Introspy对象有一个analyzer属性。我们看看analyer属性的所有方法和属性。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/093013_1617_IOSApplicat6.png" alt="" /></p>

<p>可以看到，所有的发现（findings）要么使用finding 属性要么使用get_finding方法。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/093013_1617_IOSApplicat7.png" alt="" /></p>

<p>我们也可以通过signatures这个属性来查看analyzer的所有签名。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/093013_1617_IOSApplicat8.png" alt="" /></p>

<p>不过，这些都是签名对象的实例。让我们从这些签名上获得些有意义的信息。如果我们看看signatures.py文件，我们会看到每个Signatures实例都有
属性：标题名，描述，过滤器等等。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/093013_1617_IOSApplicat9.png" alt="" /></p>

<p>现在，让我们迭代每一个签名队形，然后打印其标题名和描述</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/093013_1617_IOSApplicat10.png" alt="" /></p>

<p>如你所见，我们能够从这些实例中找出许多我们想要的信息。在接下来的例子里，我将会打印出每个签名的所有类和方法的组合。
请注意，这可能并不是filter所使用的方法实现，因为这个方法可能是类方法，也可能是实例方法。例如，如下面输出可见，这里并没有方法叫做
[NSUserDefaults stringForKey:]  不过，有个实例方法是,  [[NSUserDefaults standardUserDefaults] stringForKey:]</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/093013_1617_IOSApplicat11.png" alt="" /></p>

<p>每个analyzer对象都有一个tracedCalls属性，它是在运行时追踪到的方法调用列表。如果我们看看tracedCalls类的代码，我们可以看到它有callId，method,clazz等等
属性。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/093013_1617_IOSApplicat12.png" alt="" /></p>

<p>我们可以从任意的tracedCall分析我们想要的任何信息。如下图所示，我打印出了第一个被追踪的调用的属性。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/093013_1617_IOSApplicat13.png" alt="" /></p>

<p><br/></p>

<h2>总结</h2>

<p>在本文当中，我们查看了如何在我们自己的脚本中使用Introspy这个模块，然后用它从生成的数据库文件中获取签名，tracedCalls等信息，然后用我们想要的方式展示出来。这可以用在对某个特定应用准备我们自己的分析报告的时候。这些信息也同样可以传入其他python脚本以便做进一步的工作，比如进行运行时操作等。</p>

<p>References</p>

<p>Introspy</p>

<p><a href="https://github.com/iSECPartners/introspy">https://github.com/iSECPartners/introspy</a></p>

<p> <br/>
本文原文 <a href="http://resources.infosecinstitute.com/ios-application-security-part-19-programmatical-usage-of-introspy/">IOS Application Security Part 19 – Programmatical Usage of Introspy</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-16T00:00:00+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>ios</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/16/ios-application-security-18/" itemprop="url">iOS应用程序安全(18)-使用Introspy检测自定义签名</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>作者：Prateek Gianchandani<br/>
译者：吴发伟<br/>
原文网址：<a href="http://resources.infosecinstitute.com/ios-application-security-part-18-detecting-custom-signatures-with-introspy/">http://resources.infosecinstitute.com/ios-application-security-part-18-detecting-custom-signatures-with-introspy/</a><br/>
版权声明：自由转载-非商用-保持署名</p>

<p>在前面的文章中，我们查看了如何使用Introspy对iOS应用进行黑盒评估。本文我们将看看如何使用Introspy来建立自定义的签名，然后在追踪应用的时候检测这些自定义签名。</p>

<p>如果你对某个特定应用的某个方法特别有兴趣，并且你想直到它什么时候被调用，那么，建立预定义的签名可能会非常有用。Introsp已经有一些预定义的签名用来检测漏洞和不安全的配置。不过，它也允许我们添加自己的签名。</p>

<p>你可以在分析器的文件夹里面的signatures.py找到预定义的签名。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/092413_1140_IOSApplicat1.png" alt="" /></p>

<p>从这里，我们可以看到一个签名由标题，描述，严重等级，以及一个由方法调用组成的过滤器。让我们看看例子签名。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/092413_1140_IOSApplicat2.png" alt="" /></p>

<p>在上面的图中，你可以看到这个签名检查应用是否使用了剪贴板（Pasteboards）。剪贴板不太安全，因为他们允许应用从其中拷贝信息。
因此这个签名就说得通了。你可以看到这个过滤器（filter）有2个值，一个是classes_to_match，一个是methods_to_match。你也可以在
签名中指定一个参数args_to_match。从这个例子签名中，可以看到如下面的方法实现会符合上面的签名。</p>

<pre><code>* UIPasteboard *pasteboard = [UIPasteboard generalPasteboard];

* UIPasteboard *pasteboard = [UIPasteboard pasteboardWithName:@"XYZ" create:YES];

* UIPasteboard *pasteboard = [UIPasteboard pasteboardWithUniqueName];
</code></pre>

<p>下图所示的另一个签名检查在连接远程服务器的时候绕过凭证验证。这会发生在你使用一个自签名的SSL证书，然后想信任它而不必进行
任何验证的时候。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/092413_1140_IOSApplicat3.png" alt="" /></p>

<p>如果任意的LibC签名，让我们把classed_to_match设置为&#8221;C&#8221;</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/092413_1140_IOSApplicat4.png" alt="" /></p>

<p>现在，我们看看有参数并把参数也被当作过滤器的签名。这个过滤器能使用3个类来定义，这3各类可以在文件Filters.py中找到。这些类是
 ArgumentsFilter, ArgumentsNotSetFilter 和 ArgumentsWithMaskFilter。下面是从这些代码中用来表示其用途的截图。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/092413_1140_IOSApplicat5.png" alt="" /></p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/092413_1140_IOSApplicat6.png" alt="" /></p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/092413_1140_IOSApplicat7.png" alt="" /></p>

<p>下面是Signatures.py中的一个签名，用来检测当有数据没有secure protection domain(pdmn)又被写入keychain的时候。如你所见，</p>

<p>ArgumentsFilter 和 ArgumentsNotSetFilter 过滤器已经被使用来检测签名。ArgumentsFilter 用来找出pdmn不安全的情况。而ArgumentsNotSetFilter
用来找出没有提供accessibility 选型而默认是kSecAttrAccessibleAlways的情况。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/092413_1140_IOSApplicat8.png" alt="" /></p>

<p>现在，让我们往signature.py文件中添加一个自定义签名。在这里，我们将要检测任何取NSUserDefaults中字符串的场景。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/092413_1140_IOSApplicat9.png" alt="" /></p>

<p>现在运行introspy.py这个python脚本，参数是保存的数据库。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/092413_1140_IOSApplicat10.png" alt="" /></p>

<p>在报告的潜在发现里面（Potential Findings），你会看到这个签名在许多不同的地方都被识别出来了。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/092413_1140_IOSApplicat11.png" alt="" /></p>

<p><br></p>

<h2>总结</h2>

<p>本文我们查看了如何使用Introspy来建立自定义的签名，然后在追踪应用的时候检测这些
自定义签名。在对这些应用进行静态分析的时候，如果你想追踪特定的方法实现，那么使用这些自定义签名会非常有用。</p>

<p>References</p>

<p> Introspy</p>

<p><a href="https://github.com/iSECPartners/introspy">https://github.com/iSECPartners/introspy</a></p>

<p> <br/>
本文原文是 <a href="http://resources.infosecinstitute.com/ios-application-security-part-18-detecting-custom-signatures-with-introspy/">IOS Application Security Part 18 – Detecting custom signatures with Introspy</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-16T00:00:00+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>ios</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/16/ios-application-security-17/" itemprop="url">iOS应用程序安全(17)-使用Introspy对iOS应用进行黑盒测试</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>作者：Prateek Gianchandani<br/>
译者：吴发伟<br/>
原文网址：<a href="http://resources.infosecinstitute.com/ios-app-security-part-17-black-box-assess-ios-apps-using-introspy/">http://resources.infosecinstitute.com/ios-app-security-part-17-black-box-assess-ios-apps-using-introspy/</a><br/>
版权声明：自由转载-非商用-保持署名</p>

<p>本文我们将看看如何使用Introspy对iOS应用进行黑盒测试。Introspy由<a href="https://www.isecpartners.com/">ISEC partners</a>开发，其github地址在<a href="https://github.com/iSECPartners/introspy">这</a>。Introspy由两个单独的模块组成，一个追踪器，一个分析器。它是分析iOS应用程序安全毫无疑问的最强大工具之一。</p>

<p>第一步就是在你的设备上安装Introspy追踪器。你可以在<a href="https://www.dropbox.com/s/z5cwqk5wti3zsvd/com.isecpartners.introspy-v0.3-iOS_6.1.deb?dl=1">这</a>下载到其deb包。下载成功之后，上传并安装到你的设备上。下图展示了上面提到的步骤需要执行的操作。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/091713_1309_IOSApplicat1.png" alt="" /></p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/091713_1309_IOSApplicat2.png" alt="" /></p>

<p>一旦追踪器安装好了，重启你的设备。到设置应用，你会看到一个关于Introspy的不同区块。
现在
<img src="http://resources.infosecinstitute.com/wp-content/uploads/091713_1309_IOSApplicat3.png" alt="" /></p>

<p>Introspy App区块允许你选择想要分析的应用。因此，点击它，然后选择你想要分析的应用。我这里选择了Path应用来做分析。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/091713_1309_IOSApplicat4.png" alt="" /></p>

<p>现在到Introspy的Settings，确保每个选项都已选中，特别是选项Log to The Console（把日志输出到控制台）。如果我们选中
这个选项，Introspy分析器将会把它找到的关于这个应用（app）所有信息都输出到控制台，这样我们就能在运行时看到这些信息。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/091713_1309_IOSApplicat5.png" alt="" /></p>

<p>一旦选中了Path应用，请确保它没有在运行。如果它正在运行，请退出并重启Path。另外，请确保你的设备和你的电脑连接好了，因为我们想要看Introspy
分析器记录的日志。同时，请大家你机器上的Xcode（如果你在Mac上），到Window-> Organizer->Devices。在左边的菜单选择你的设备，然后选择控制台。
现在你就可以看到你的设备的日志。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/091713_1309_IOSApplicat6.png" alt="" /></p>

<p>现在开启Path应用，然后尽可能多的使用这个应用。同时，Introspy分将会在后台运行，并且会尽可能多的收集关于这个应用的信息。你也可以看到设备的日志。
这里，我们可以看到有一个向server发起的请求，我们可以看到这个请求的所有内容，包括路径和请求参数。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/091713_1309_IOSApplicat7.png" alt="" /></p>

<p>并且现在，你可以看到这个应用正在使用NSUserDefaults来验证userId这个键。这个信息其实应该保存在keychain的。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/091713_1309_IOSApplicat8.png" alt="" /></p>

<p>但是最有趣的的信息可以从下面的图中看到。正如你所见，这个应用使用NSUserDefaults来验证HangTracerEnabled这个布尔值。这个可能是
用来看这个应用是否在运行时被分析，如果是的话，就退出。不过，这技巧看起来失败了，因为它没有能够检测到Introspy分析器。
不过当我用Snoop-it分析Path应用的时候，它crash了。所以，这个布尔值确定无疑的是用来看应用是否正追踪（被分析）。我们将会在随后的
文章中介绍这些概念。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/091713_1309_IOSApplicat9.png" alt="" /></p>

<p>除了在控制台展示这个应用的运行时信息，Introspy也能够把它保存到你设备上的一个sqlite数据库中。从你的电脑上，你可以获取这个数据库文件
并且Introspy会把它转换成可展示的格式。要从你的iOS 设备上获取这个数据库，首先你需要github页面下载<a href="https://github.com/iSECPartners/introspy/archive/master.zip">Introspy</a>。到这个分析器的目录，
然后使用如下图的命令。你需要指定在你本地机器上要把报告保存的位置，同时也要指定你的iOS设备的IP地址。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/091713_1309_IOSApplicat9.png" alt="" /></p>

<p>如你所见，Introspy会要求你选择一个数据库文件。这些数据库文件是为每个我们在Settings中选择的应用创建的。在这里，我们选择为Path应用创建的
数据库。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/091713_1309_IOSApplicat10.png" alt="" /></p>

<p>你可以看到，这个数据库被保存在当前目录下面，同时，当前目录下有一个叫做Path-Report的文件夹被创建。如果我们进入那个文件夹，并且
打开report.html，下图就是我们将会看到的内容。如你所见，Introspy已经用一个很不错的方法把全部信息都展示出来了。我们可以看到被追踪的调用
和其参数。。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/091713_1309_IOSApplicat12.png" alt="" /></p>

<p>我们也可以看到其中有一列叫做&#8221;Potential Findings&#8221;。这些都是Introspy认为存在漏洞的地方。在这里，我们将看看存储数据不安全的问题。
这可能不算是一个漏洞，因为保存的信息不一定非常重要。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/091713_1309_IOSApplicat13.png" alt="" /></p>

<p>你也可以像下图那样，选择某些选项来定制你看到的信息。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/091713_1309_IOSApplicat14.png" alt="" /></p>

<p>例如，我已经把它配置成只显示关于UserPreferences的方法。这个信息可能会非常有用，因为它可以帮我们找出那些可能被写入NSUserDefaults的一些重要信息。
即使没有在下图中显示，我也能够容易的知道Path把我的用户id（userId）保存到NSUserDefaults，并且在很多地方都会用到（这个用户id）。这个信息理应保存在
更安全的地方，比如，keychain。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/091713_1309_IOSApplicat15.png" alt="" /></p>

<p>我们也可以直接从命令行对保存的数据库文件进行分析。下面是使用信息。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/091713_1309_IOSApplicat16.png" alt="" /></p>

<p>让我们给这个命令传递参数http&#8217;。如你所见，它导出了一列通信方的列表。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/091713_1309_IOSApplicat17.png" alt="" /></p>

<p>Introspy也可以被其他Python脚本导入。我们也可以增加签名来标志漏洞或者不安全的配置。我们将在随后的文章中作介绍。</p>

<p><br></p>

<h2>总结</h2>

<p>本文我们查看了如何使用Introspy对iOS应用进行黑盒测试。Introspy由两个模块组成，
一个追踪器，一个分析器。我们可以用追踪器来对应用执行运行时分析。追踪器会把信息保存到sqlite文件中以便后续用分析器分析，追踪器也可以把所有信息都输出到设备的控制台上。分析器可以用这个数据库文件生成一个详尽的HTML报告。</p>

<p>References</p>

<p>Introspy</p>

<p><a href="https://github.com/iSECPartners/introspy">https://github.com/iSECPartners/introspy</a></p>

<p> <br/>
本文原文是 <a href="http://resources.infosecinstitute.com/ios-app-security-part-17-black-box-assess-ios-apps-using-introspy/">IOS Application Security Part 17 – Black-box assessment of IOS Applications using Introspy</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-15T00:00:00+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>ios</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/15/ios-application-security-16/" itemprop="url">iOS应用程序安全(16)-使用iNalyzer对iOS应用进行动态分析</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>作者：Prateek Gianchandani<br/>
译者：吴发伟<br/>
原文网址：<a href="http://resources.infosecinstitute.com/ios-app-security-part-16-runtime-analysis-of-ios-apps-using-inalyzer/">http://resources.infosecinstitute.com/ios-app-security-part-16-runtime-analysis-of-ios-apps-using-inalyzer/</a><br/>
版权声明：自由转载-非商用-保持署名</p>

<p>上一篇文章我们看到了如何使用iNalyzer对iOS应用进行静态分析。本文我们将看看如何用iNalyer对iOS应用进行运行时分析。我们能够在运行时调用方法，能够在应用的某个特殊时间找出特定实例变量的值，基本上能做我们用Cycript做的所有事情。</p>

<p>在上一篇文章当中，我们成功的用Doxygen生成了html文件，并且打开它看到了关于这个应用的类信息和其他信息。我们将使用Firefox浏览器进行运行时分析。这个工具的开发者推荐我再进行运行时分析的时候使用Firefox浏览器，因为其它浏览器用起来可能会有问题。 不过，对我来说，在chrome上好像也工作正常。</p>

<p>要打开运行时解释器，首先需要打开Doxygen为你想要分析的应用生成的index.html文件，然后双击左剪头键。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090913_1208_IOSApplicat1.png" alt="" /></p>

<p>如上图所示，你可以看到有一个可以输入命令的控制台在顶部出现。第一件事情就是告诉iNalyer你设备的IP地址，在这里是10.0.1.23。输入IP地址后然后确定（按Enter）。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090913_1208_IOSApplicat2.png" alt="" /></p>

<p>一旦IP地址设置好之后，请确保我们要分析的应用在设备上是打开的（例如，在前台），并且你的设备没有休眠。这非常重要，
因为如果你的应用在后台或者你的设备在休眠，那你的应用是会被操作系统给暂停的，因此就不可能对这个应用进行任何运行时分析。</p>

<p>一旦应用打开，在控制台输入任意命令，如你使用Cycript会输入的一样。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090913_1208_IOSApplicat3.png" alt="" /></p>

<p>正如我们看到的那样，我们会得到一个响应。我们现在可以输入我们想要输入的任何cycript命令。</p>

<p>让我们隐藏应用的状态栏。我们可以用这个命令， [[UIApplication sharedApplication] setStatusBarHidden:YES animated:YES];</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090913_1208_IOSApplicat4.png" alt="" /></p>

<p>可以看到，我们并没有得到任何响应，那是因为这个方法返回空（void）。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090913_1208_IOSApplicat5.png" alt="" /></p>

<p>不过，应用的状态栏已经隐藏起来了。我们在最上面已经看不到时间了。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090913_1208_IOSApplicat6.png" alt="" /></p>

<p>类似的，我们可以找到这个应用的delegate类。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090913_1208_IOSApplicat7.png" alt="" /></p>

<p>我们也可以设置应用的提醒数字。这里我们设置为9000。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090913_1208_IOSApplicat8.png" alt="" /></p>

<p>可以看到，提醒数字成功设置。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090913_1208_IOSApplicat9.png" alt="" /></p>

<p>因为这和有一个cycript控制台类似，我们也可以输入javascript代码和任何其他Cycript文档中的命令。
下面就是我输入的从<a href="http://iphonedevwiki.net/index.php/Cycript_Tricks">Cycript tricks</a>页面引用的一个命令。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090913_1208_IOSApplicat10.png" alt="" /></p>

<p>类似的，我可以同时用javascript和Objective-C的语法来创建函数。如果你对这里说的Cycript不太理解，请
参考本系列前面介绍Cycript和它的详细用法的文章。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090913_1208_IOSApplicat11.png" alt="" /></p>

<p>我可以在想要使用这个函数的任何时刻用它。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090913_1208_IOSApplicat12.png" alt="" /></p>

<p>在本系列的<a href="http://wufawei.com/2013/11/ios-application-security-9/">第9部分</a>，我们介绍了Snoop-it。iNalyer和Snoop-it非常类似。不过二者都有优点和不足。
在本文写关于Snoop-it的时候，它并不支持method swizzling而iNalyer支持。蕾丝的，iNalyer不允许我们
监控API调用而Snoop-it可以。因此，这两个应用都有它们的优点和不足。</p>

<p><br></p>

<h2>总结</h2>

<p>本文我们学习了如何利用iNalyer来对iOS应用进行运行时分析。对于任何对iOS应用程序安全感兴趣的人来说，iNalyer都是武器库中非常棒的工具，它使得我们的工作更容易、更有效率。</p>

<p>References</p>

<p>iNalyzer
<a href="https://appsec-labs.com/iNalyzer">https://appsec-labs.com/iNalyzer</a></p>

<p> <br/>
本文原文是 <a href="http://resources.infosecinstitute.com/ios-app-security-part-16-runtime-analysis-of-ios-apps-using-inalyzer/">IOS Application Security Part 16 – Static Analysis of IOS Applications using iNalyzer</a></p>

		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
        <a href="1" class="prev">Prev</a>
    
    
        <a href="3" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2015

    小巴


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
		</div>
	</div>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>
