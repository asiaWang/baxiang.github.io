
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>小巴童鞋</title>
	<meta name="author" content="小巴">

	
	<meta name="description" content="ios iOS应用程序安全(15)-使用iNalyzer对iOS应用进行静态分析 作者：Prateek Gianchandani
译者：吴发伟
原文网址：http://resources.infosecinstitute.com/part-15-static-analysis-of-ios- &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="小巴童鞋" type="application/atom+xml">
	
	<link rel="canonical" href="http://baxiang123.com//posts/2/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="http://cdn.staticfile.org/jquery/1.9.1/jquery.min.js"></script>
	<link href="/stylesheets/google-fonts.css" rel="stylesheet" type="text/css">
	
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		document.write("<img src='/images/xiaoba.png" + "?s=160' alt='Profile Picture' style='width: 160px;' />");
	</script>
</div>
<h1>&nbsp;&nbsp;<a href="/">小巴童鞋</a></h1>
<p class="subtitle">Xiaoba&#8217;s technology blog</p>
<nav id="main-nav"><ul class="main">
    <li><a href="/">主页 Blog</a></li>
    <li><a href="http://about.me/shashankmehta">关于 About</a></li>
    <li><a href="/blog/archives">归档 Archives</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="weibo" href="http://www.weibo.com/1655203353" title="Weibo">Weibo</a>
		
		
		<a class="facebook" href="http://www.facebook.com/xiang.ba.1" title="Facebook">Facebook</a>
		
		
		
		<a class="twitter" href="http://twitter.com/baxiang2014" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/baxiang" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>

</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-15T00:00:00+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>ios</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/15/ios-application-security-15/" itemprop="url">iOS应用程序安全(15)-使用iNalyzer对iOS应用进行静态分析</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>作者：Prateek Gianchandani<br/>
译者：吴发伟<br/>
原文网址：<a href="http://resources.infosecinstitute.com/part-15-static-analysis-of-ios-apps-using-inalyzer/">http://resources.infosecinstitute.com/part-15-static-analysis-of-ios-apps-using-inalyzer/</a><br/>
版权声明：自由转载-非商用-保持署名</p>

<p>在前面的文章当中，我们看到了如何使用Sogeti Data protection tools利用bottom的漏洞，使用定制的ramdisk来启动iOS设备。本文我们将学习用iNalyzer工具来对iOS
应用进行黑盒测试。iNalyzer允许我们查看类信息，执行运行时分析和其他一些事情。基本上它把解密应用、导出类信息这些事情自动化了，并且更好的展示了出来。我们也可以像Cycript那样挂钩运行的进程。iNalyzer由<a href="https://appsec-labs.com/">AppSec Labs</a>开发和维护，它的官方地址在<a href="https://appsec-labs.com/iNalyzer">这</a>。iNalyzer同时也已经开源了，gitub地址在<a href="https://github.com/appsec-labs/iNalyzer">这</a>。</p>

<p>在用iNalyzer之前，有些依赖的软件需要先安装。请确保<a href="http://www.graphviz.org/download..php">Graphviz</a> 和<a href="http://www.stack.nl/~dimitri/doxygen/download.html">Doxygen</a>已经安装了，因为没有这2个工具，iNalyzer不会正常工作。并且，请注意，
我在Mac OS X Mountain Lion 10.8.4上做的测试，但是我们用最新版本的Graphviz的时候它经常会挂起（hang）。因此，我下载了Graphviz的一个较老的版本（v 2.30.1）
，并且这个老版本工作正常。你可以在<a href="http://www.graphviz.org/pub/graphviz/stable/macos/">这</a>找到Graphviz for Mac的老版本。</p>

<p>第一步就是在你的iOS 设备上安装iNalyzer。先到Cydia->管理, 确保源<a href="http://appsec-labs.com/cydia/%E8%A2%AB%E6%88%90%E5%8A%9F%E6%B7%BB%E5%8A%A0%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE%E3%80%82">http://appsec-labs.com/cydia/%E8%A2%AB%E6%88%90%E5%8A%9F%E6%B7%BB%E5%8A%A0%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE%E3%80%82</a></p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat1.png" alt="" /></p>

<p>然后到Cydia的搜索，搜索 iNalyzer。根据你现在设备上正在运行的iOS版本，选择对应版本的iNalyzer。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat2.png" alt="" /></p>

<p>如你所见，我已经把iNalyzer安装好了。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat3.png" alt="" /></p>

<p>现在ssh进入设备，，然后转到iNalyzer应用所在的目录。iNalyzer安装在/Applications目录，因为它需要以root用户权限运行。如果你不了解这个概念，请确保你读过本系列
前面的文章。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat4.png" alt="" /></p>

<p>输入./iNalyzer启动iNalyzer。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat5.png" alt="" /></p>

<p>现在如果你到主屏幕，然后看看iNalyzer应用图标，你会看到有个提醒数字。这表明这个应用 可以通过web接口访问，然后这个提醒数字就代表的是端口号。
如果你再次运行 ./iNalyzer，那么iNalyzer就会停止。因此，请确保记得./iNalyer是开启还是关闭这个应用。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat6.png" alt="" /></p>

<p>现在你可以找到你的设备的IP地址，然后用ip:port的方式在浏览器上打开。这里端口是5544,IP地址是10.0.1.23.因此url地址是<a href="http://10.0.1.23:5544/%E3%80%82%E4%B8%80%E6%97%A6%E4%BD%A0%E6%89%93%E5%BC%80%E8%BF%99%E4%B8%AA%E9%A1%B5%E9%9D%A2%EF%BC%8C">http://10.0.1.23:5544/%E3%80%82%E4%B8%80%E6%97%A6%E4%BD%A0%E6%89%93%E5%BC%80%E8%BF%99%E4%B8%AA%E9%A1%B5%E9%9D%A2%EF%BC%8C</a>
你会看到如下图的界面。你可以选择一个应用，然后iNalyzer就会准备一个zip文件，然后下载到你的系统上以便分析。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat7.png" alt="" /></p>

<p>不过，我在这行这一步的时候却遇到一些问题。因此，我们将使用一个替代方法来完成这一步。首先确保iNalyer正在运行。然后转到iNalyer的目录下，然后不带任何参数的运行
iNalyer5。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat8.png" alt="" /></p>

<p>现在你可以看到一系列可以用来分析的应用。这里我们选择Defcon应用来分析。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat9.png" alt="" /></p>

<p>你可以看到iNalyer已经开始工作。它首先解密应用，找出对应的类信息和其它一些信息。如下图所示，一旦iNalyzer完成它的工作，它就会创建一个ipa文件，然后把它
保存到下图高亮的地址。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat10.png" alt="" /></p>

<p>现在我们需要得到这个ipa文件，然后把它下载到我们的系统上（电脑上）。我们可以用sftp。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat11.png" alt="" /></p>

<p>一旦我们得到ipa文件，把它后缀名改为zip，然后解压这个文件。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat12.png" alt="" /></p>

<p>在终端（Terminal, 命令行）下，转到其内部的Payload－> Doxygen目录下。如下图。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat13.png" alt="" /></p>

<p>你会看到有一个叫做doxMe.sh的shell脚本。如果你看看它的内容，你会看到它把运行Doxygen的工作自动化了。
Doxygen也会运行Graphviz来产生图表，结果会保存在内部一个叫做html的文件夹下。基本上，iNalyzer已经把所有的类信息替我们保存在
内部一个叫做Reversing Files的目录下了，而且它用Doxygen和Graphviz来把信息更友好的展示出来了。这个脚本同时也会把新创建的html文件夹内部的
index.html文件打开。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat14.png" alt="" /></p>

<p>现在，我们来运行这个脚本，让iNalyzer为我们做所有的事情。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat15.png" alt="" /></p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat16.png" alt="" /></p>

<p>一旦这个命令完成，iNalyer会把新创建的html文件夹内部的index.html文件打开。 下面就是打开的样子。在这里，我用的是chrome。不过，这个工具的开发者
推荐我再进行运行时分析的时候使用firefox浏览器，因为其它浏览器用起来可能会有问题。如下图所示，第一页给出了对整个应用的字符串分析。它把字符串分成了
SQL和URL字符串。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat17.png" alt="" /></p>

<p>你也可以看看应用中使用的所有的view controller。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat18.png" alt="" /></p>

<p>点击任意的View controller，你可以看到它的方法和属性。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat19.png" alt="" /></p>

<p>你也可以看看Info.plist文件的内容。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat20.png" alt="" /></p>

<p>如果你选择Classes这个Tab，在Class Index下面你回看到所有应用中使用的类的列表。有些是苹果自己的类，有些是这个应用的开发者创建的。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat21.png" alt="" /></p>

<p>如果你到Class Hierarchy Tab（类层次标签）下，你可以看到以图像方式展示的类信息和它们之间的关系。这会给你大量关于应用如何工作的知识。
这些图使用Graphviz这个工具产生的。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/090313_1547_IOSApplicat22.png" alt="" /></p>

<p>如果你选择文件标签（files tab), 你可以看到iNalyer生成的所有接口文件。</p>

<p> <br/></p>

<h2>总结</h2>

<p> 本文我们学习了如何使用iNalyer对iOS应用程序进行静态分析，可以看到它使我们的工作变得非常容易。在接下来的文章中，我们将看看如何用iNalyer对iOS应用进行运行时分析。</p>

<p> <br/>
本文原文是 <a href="http://resources.infosecinstitute.com/part-15-static-analysis-of-ios-apps-using-inalyzer/">IOS Application Security Part 15 – Static Analysis of IOS Applications using iNalyzer</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-15T00:00:00+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>ios</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/15/ios-application-security-14/" itemprop="url">iOS应用程序安全(14)-使用Sogeti Data Protection Tools收集信息</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>作者：Prateek Gianchandani<br/>
译者：吴发伟<br/>
原文网址：<a href="http://resources.infosecinstitute.com/ios-application-security-part-14-gathering-information-using-sogeti-data-protection-tools/">http://resources.infosecinstitute.com/ios-application-security-part-14-gathering-information-using-sogeti-data-protection-tools/</a><br/>
版权声明：自由转载-非商用-保持署名</p>

<p>在前面一篇文章中，我们看到了如何使用Sogeti Data Protection tools用定制的ramdisk启动iOS设备。本文我们将如何用其中的一些工具来收集设备的信息，比如keychain的内容，导出整个文件系统甚至暴力破解口令。</p>

<p>在上一篇文章当中，我们已经成功的用usbmux与设备建立了连接，ssh进设备，并且加载了分区。下面是分区包含的内容。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082713_1245_IOSApplicat1.png" alt="" /></p>

<p>现在我们可以自由的在这些分区内部切换，做任何我们想要做的事情。正如我们看到的，iphone data protection tools给我们提供了一些可以使用的脚本。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082713_1245_IOSApplicat2.png" alt="" /></p>

<p>现在让我们使用下暴力破解脚本。当前我这个ipod的口令（passcode）是“1234”。这意味着keychain以这个口令保护着（参见前面的文章），因此如果我们
想要到处keychain中的数据，我们就需要找到口令。我们先运行这个脚本。如你所见，它开始执行暴力破解。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082713_1245_IOSApplicat3.png" alt="" /></p>

<p>一段时间之后，我们可以看到它成功的找到我们的口令。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082713_1245_IOSApplicat4.png" alt="" /></p>

<p>可以看到，这些结果被写入到一个plist文件。这个plist文件被其他python脚本使用，例如，被口令保护的keychain信息导出的时候需要使用口令。这里还有另一个python
脚本可以用来暴力破解口令，位于data protection tools的python_scripts目录下。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082713_1245_IOSApplicat5.png" alt="" /></p>

<p>一旦口令被算出，它就会以你的设备的UDID为名创建一个文件夹，然后把包含口令信息的plist文件保存到这个文件夹中。你可以在其他时候使用这个plist文件，
比如解密keychain的时候。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082713_1245_IOSApplicat6.png" alt="" /></p>

<p>下面就是那个plist文件保存的信息。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082713_1245_IOSApplicat7.png" alt="" /></p>

<p>请注意，使用一个字母、数字组合的密码会让这个破解更困难，因此使得keychain的数据得到更好的保护。不过，大多数人都不关注这个，并且喜欢使用
简单的4位数字密码。</p>

<p>不管怎样，先回到设备上，这里有另一个脚本叫做device_infos可以用来导出关于设备的信息，比如序列号，Mac地址等等。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082713_1245_IOSApplicat8.png" alt="" /></p>

<p>其中最重要的一个python脚本之一就是ios_examiner python脚本。不过，我在运行的时候，得到一个关于unicode字符串的错误提示，我在<a href="https://code.google.com/p/iphone-dataprotection/issues/detail?id=70">这个链接</a>的帮助下修改了这个
python脚本。</p>

<p>现在运行ios_examiner 这个python脚本。你会看到一个可以输入命令的解释器。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082713_1245_IOSApplicat9.png" alt="" /></p>

<p>你可以通过输入help来看到所有的命令集合。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082713_1245_IOSApplicat10.png" alt="" /></p>

<p>你可以输入keychain来导出keychain。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082713_1245_IOSApplicat11.png" alt="" /></p>

<p>不过，你会注意到输出说“ Keybag state: locked”，因此有些条目没有显示（显示为？）。有些条目被更高的保护属性保护（比如AfterFirtUnlock)，
因此它们需要设备的口令才能解密。不过，我们前面不是已经成功的找到了口令了呀？是的，虽然已经找出了口令，不过我们用了另一个python
脚本，因此保持口令信息的plist文件被保存在另外的地方。最简单的方法就是在解释器中使用暴力破解脚本，输入口令，让它保存plist文件到当前
位置，现在你可以再次使用keychain脚本了。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082713_1245_IOSApplicat12.png" alt="" /></p>

<p>使用命令protected_files会给出一系列不是以NSProtectionNone保护的文件。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082713_1245_IOSApplicat13.png" alt="" /></p>

<p>你也可以导出当前的分区为一个.dmg文件供后续加载分析使用。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082713_1245_IOSApplicat14.png" alt="" /></p>

<p>还有另一个shell脚本可以为你导出分区。它把创建的.dmg文件保存到一个以设备的UDID命名的文件夹内。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082713_1245_IOSApplicat15.png" alt="" /></p>

<p>一旦这个.dmg文件生成完毕，你可以选择它并加载。现在你可以在任意时候探索这个文件系统了 。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082713_1245_IOSApplicat16.png" alt="" /></p>

<p>现在你可以使用reboot命令来重启系统，然后系统就会回到之前的状态。请确保设备与你的电脑断开之后再这么做（重启系统）。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082713_1245_IOSApplicat17.png" alt="" /></p>

<p><br/></p>

<h2>总结</h2>

<p>本文我们学习了使用Sogeti Data Protection tools 来从设备上收集不同的信息，比如keychain数据，被保护的文件，等等。我们也可以导出整个文件系统以便随后再分析。
这个技巧可以在任何使用A4芯片的设备上用bootrom 漏洞利用使用，而且并不需要对设备越狱，设备重启之后又会回到正常状态，因此，普通用户根本不知道发生了什么。</p>

<p>References</p>

<p> Iphone-dataprotection – IOS Forensics tools
<a href="https://code.google.com/p/iphone-dataprotection/">https://code.google.com/p/iphone-dataprotection/</a></p>

<p><br/>
本文原文是 <a href="http://resources.infosecinstitute.com/ios-application-security-part-14-gathering-information-using-sogeti-data-protection-tools/">IOS Application Security Part 14 – Gathering information using Sogeti Data Protection tools</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-15T00:00:00+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>ios</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/15/ios-application-security-13/" itemprop="url">iOS应用程序安全(13)-使用Sogeti Data Protection tools启动定制的Ramdisk</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>作者：Prateek Gianchandani<br/>
译者：吴发伟<br/>
原文网址：<a href="http://resources.infosecinstitute.com/ios-application-security-part-13-booting-a-custom-ramdisk-using-sogeti-data-protection-tools/">http://resources.infosecinstitute.com/ios-application-security-part-13-booting-a-custom-ramdisk-using-sogeti-data-protection-tools/</a><br/>
版权声明：自由转载-非商用-保持署名</p>

<p>在前面的文章当中，我们学习了如何使用Keychain-Dumper和Snoop-it来从iOS设备上导出和分析keychain的内容。本文我们将看看如何用一个自己的ramdisk来启动一个没有越狱的设备，并且分析该设备的内容。</p>

<p>为什么要用一个定制的ramdisk来启动设备呢？假设一个场景，你只能短暂的访问一个设备，并且不能越狱它。你只能访问这个设备，比如：30分钟。
这种情况下，你可以用定制的ramdisk启动设备，然后暴力破解口令，导出所有数据以便后续分析。为了执行这样的攻击，最好的情况就是这个设备不需要越狱。
当然，如果设备使用字母数字组合的密码，那可能就需要更长的时间来暴力破解口令了。你可以把这种情况设想为用一个Linux live CD来启动一个windows机器，
然后加载windows分区，然后使用Linux OS来访问硬盘的内容。不过，使用定制的ramdisk来加载设备需要一个bootrom漏洞。<a href="http://theiphonewiki.com/wiki/Bootrom">bootrom</a>是IDevice上运行的第一个重要的代码。
bootrom漏洞允许我们在bootloader的低层次绕过bootrom签名验证，使得我们可以用定制的ramdisk启动设备。这样的漏洞能够让用户执行未签名的代码，因此可以创造一个
untethered jailbreak。能够获得bottom漏洞列表在<a href="http://theiphonewiki.com/wiki/Category:Bootrom_Exploits">此</a>。一个bottom漏洞一旦被发现就不可能被苹果以发布一个新的iOS系统的方式来修复，只可能发布新硬件才能修复。
在写本文的时候，从采用A5及以后（芯片）的设备，没有发现bootrom exploit。本文我们将要使用的bootrom利用将只能工作在使用A4的设备上。我将使用一个4代iPod touch，
因为它有一个A4芯片。本文我们将专注在如何用定制的ramdisk来启动设备，我们将在下一篇文章中关注如何利用启动后的设备。</p>

<p>一个非常容易的方法就是下载<a href="http://msftguy.blogspot.in/2012/01/automatic-ssh-ramdisk-creation-and.html">这个工具</a>，这个工具允许自动的SSH ramdisk生成。它非常易用，你可以看看这个<a href="http://www.youtube.com/watch?feature=player_embedded&amp;v=1dh5loiX1dU">视频</a>了解更多细节。不过，在本文当中，我们将会看看
Sogeti data protection tools，最主要的原因就是它提供了许多我们可以利用的python脚本。</p>

<p>关于如何使用定制的ramdisk来启动的指令可以看<a href="https://code.google.com/p/iphone-dataprotection/wiki/README">这</a>。我们将在运行Mac OSX 10.8.4的系统上运行同样的指令。</p>

<p>首先，确保你的系统上安装了Mercurial。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/082213_1252_IOSApplicat1.png" alt="" /></p>

<p>然后，创建一个新目录，并进入到里面。然后安装ldid工具，请确保它是可执行的并把它移动到/usr/bin目录。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/082213_1252_IOSApplicat2.png" alt="" /></p>

<p>我们需要创建些符号连接。请注意下图的第二个命令，我们创建了一个到Xcode.app的符号连接。通常情况下如果你是iOS开发者，并且在系统上安装了多个Xcode版本，
你可能已经把它们命名为不同的名字，比如Xcode-4.5.2或者Xcode-5.1。因此，请注意这个命令可能执行失败，并提示你iOS SDK找不到。一个解决方法就是
把你的Xcode应用的文件夹命名为Xcode。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/082213_1252_IOSApplicat3.png" alt="" /></p>

<p>下一步，我们需要安装OSXFuse，可以用来为OS X创建文件系统。根据你运行的操作系统而定，有些版本的OSXFuse可能会不兼容。因此，请确保下载能在你的系统上运行的
版本。我下载的是版本是2.5.4，在OS X 10.8.4上工作良好。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/082213_1252_IOSApplicat4.png" alt="" /></p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082213_1252_IOSApplicat5.png" alt="" /></p>

<p>然后你需要安装一些python模块</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/082213_1252_IOSApplicat6.png" alt="" /></p>

<p>下一步就是构建定制的ramdisk和内核。我们需要先clone iphone data protection。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082213_1252_IOSApplicat7.png" alt="" /></p>

<p>然后我们使用下面的命令来创建文件系统。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082213_1252_IOSApplicat8.png" alt="" /></p>

<p>然后我们就可以下载redsn0w, 拷贝其中的Keys.plist文件</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082213_1252_IOSApplicat9.png" alt="" /></p>

<p>现在你需要下载任意版本的iOS5的IPSW文件。与目标设备上目前正在运行什么操作系统没有关系。你可以根据你的设备从<a href="http://theiphonewiki.com/wiki/Firmware">这</a>下载IPSW文件。
一旦IPSW文件下载完毕，把它复制到当前目录。然后用下面的命令给内核打补丁，参数就传刚刚下载的IPSW文件。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082213_1252_IOSApplicat10.png" alt="" /></p>

<p>这样就会创建好一个.sh文件，我们可以用它来构建ramdisk。我们运行看看。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082213_1252_IOSApplicat11.png" alt="" /></p>

<p>一旦ramdisk创建好了，你会在命令行看到你要启动这个ramdisk所需要的命令。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082213_1252_IOSApplicat12.png" alt="" /></p>

<p>现在我们使用这个命令来启动定制的ramdisk然后给内核打补丁。请注意即使这个命令以redsn0w起头，我们已经移到redsn0w所在的目录并以该目录下的
二进制文件替换掉命令中的redsn0w。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082213_1252_IOSApplicat13.png" alt="" /></p>

<p>这样就会打开redsn0w.</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082213_1252_IOSApplicat14.png" alt="" /></p>

<p>现在我的iPod正连接到设备，并且没有关机。因此我们按redsn0w的要求关机。一旦iPod关机，redsn0w上的下一步按钮就可以点击（enable）了。点击下一步，
然后你会看到redsn0w要求你让设备进入DFU模式。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082213_1252_IOSApplicat15.png" alt="" /></p>

<p>我们依照redsn0w的要求操作。一旦你的设备进入DFU模式，你会看到redsn0w已经开始注入漏洞利用程序。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082213_1252_IOSApplicat16.png" alt="" /></p>

<p>然后它会重启设备。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082213_1252_IOSApplicat17.png" alt="" /></p>

<p>你的设备看起来会像下面的图这样。一段时间之后，你会在屏幕之上看到一个大大的ok说明漏洞利用程序已经成功执行并且这个定制的ramdisk也已经开启了。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082213_1252_IOSApplicat19.jpg" alt="" /></p>

<p>data protection tools中也包含一个python实用工具叫做 usbmux，现在我们可以用它通过ssh来访问设备。让我们用python脚本 tcprelay 先建立中继转发。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082213_1252_IOSApplicat20.png" alt="" /></p>

<p>在一个不同的tab上，我们能够ssh进本地的2222端口，然后usbmux会把这个连接中继转发（forward）到通过USB连接到端口22的远程设备上。请注意你的设备需要
通过USB连接到你的电脑上。然后输入ls。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082213_1252_IOSApplicat21.png" alt="" /></p>

<p>我们可以看到一个mount_partitions shell脚本。我们可以用它来加载分区。然后我们回到root目录，我们可以看到2个分区，mnt1和mnt2。我们可以进入并探索这个文件系统了。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/082213_1252_IOSApplicat22.png" alt="" /></p>

<p>恭喜你！我们已经成功的用一个定制的ramdisk启动设备了，我们现在能够进一步探索这个文件系统了。</p>

<p><br/></p>

<h2>总结</h2>

<p>本文我们学习了如何通过定制的ramdisk启动iOS设备，并且可以用它来进一步探索该设备的文件系统。在接下来的文章中，我们将看看Sogeti data protection tools 提供的不同工具，然后用这些工具做不同的任务，比如暴力破解口令，导出keychain文件，甚至对整个文件系统做备份。</p>

<p>References</p>

<p>Iphone-dataprotection – IOS Forensics tools
<a href="https://code.google.com/p/iphone-dataprotection/">https://code.google.com/p/iphone-dataprotection/</a></p>

<p><br/>
本文原文是 <a href="http://resources.infosecinstitute.com/ios-application-security-part-13-booting-a-custom-ramdisk-using-sogeti-data-protection-tools/">IOS Application Security Part 13 – Booting a custom Ramdisk using Sogeti Data Protection tools</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-15T00:00:00+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>ios</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/15/ios-application-security-12/" itemprop="url">iOS应用程序安全(12)-导出Keychain数据</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>作者：Prateek Gianchandani<br/>
译者：吴发伟<br/>
原文网址：<a href="http://resources.infosecinstitute.com/ios-application-security-part-12-dumping-keychain-data/">http://resources.infosecinstitute.com/ios-application-security-part-12-dumping-keychain-data/</a><br/>
版权声明：自由转载-非商用-保持署名</p>

<p>在前面的文章中，我们查看了如何用不同的方法来分析应用的网络流量和API调用。本文我们将会从iOS设备中导出keychain的内容。</p>

<p><br></p>

<h2>Keychain 基础</h2>

<p>根据苹果的介绍，iOS设备中的Keychain是一个安全的存储容器，可以用来为不同应用保存敏感信息比如用户名，密码，网络密码，认证令牌。苹果自己用keychain来保存Wi-Fi网络密码，VPN凭证等等。它是一个sqlite数据库，位于/private/var/Keychains/keychain-2.db，其保存的所有数据都是加密过的。</p>

<p>开发者通常会希望能够利用操作系统提供的功能来保存凭证（credentials）而不是把它们（凭证）保存到NSUserDefaults,plist文件等地方。保存这些数据的原因是开发者不想用户每次都要登录，因此会把认证信息保存到设备上的某个地方并且在用户再次打开应用的时候用这些数据自动登录。Keychain的信息是存在于每个应用（app）的沙盒之外的。</p>

<p>通过keychain access groups可以在应用之间共享keychain中的数据。要求在保存数据到keychain的时候指定group。把数据保存到keychain的最好方法就是用苹果提供的KeychainItemWrapper。可以到<a href="http://developer.apple.com/library/ios/">这</a>下载例子工程。第一步就是创建这个类的实例。</p>

<p>KeychainItemWrapper *wrapper = [[KeychainItemWrapper alloc] initWithIdentifier:@”Password” accessGroup:nil];</p>

<p>标识符（Identifier）在后面我们要从keychain中取数据的时候会用到。如果你想要在应用之间共享信息，那么你需要指定访问组（access group）。有同样的访问组
的应用能够访问同样的keychain信息。</p>

<p>KeychainItemWrapper *wrapper = [[KeychainItemWrapper alloc] initWithIdentifier:@”Account Number” accessGroup:@”YOUR_APP_ID_HERE.com.yourcompany.GenericKeychainSuite”];</p>

<p>要把信息保存到keychain中，使用 setObject:forKey: 方法。在这里， (id)kSecAttrAccount 是一个预先定义好的键（key），我们可以用它来保存账号名称。
kSecClass指定了我们要保存的某类信息，在这里是一个通用的密码。kSecValueData可以被用来保存任意的数据，在这里是一个密码。</p>

<p>[keychainItemWrapper setObject:kSecClassGenericPassword forKey:(id)kSecClass];</p>

<p>[wrapper setObject:@&ldquo;username&rdquo; forKey:(id)kSecAttrAccount];</p>

<p>[keychainItemWrapper setObject:@&ldquo;password&#8221;forKey:(id)kSecValueData];</p>

<p>[wrapper setObject:(id)kSecAttrAccessibleAlwaysThisDeviceOnly forKey:(id)kSecAttrAccessible];</p>

<p>kSecAttrAccessiblein变量用来指定这个应用合适需要访问这个数据。我们需要对这个选项特别注意，并且使用最严格的选项。这个键（key）可以设置6种值。</p>

<p>你可以从如下对苹果的<a href="http://developer.apple.com/library/mac/">文档</a>的截图看到。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/080513_1630_IOSApplicat1.png" alt="" /></p>

<p>当然，我们应该绝对不要使用kSecAttrAccessibleAlways。一个安全点的选项是kSecAttrAccessibleWhenUnlocked。这也有些选项是以 ThisDeviceOnly 结尾的。如果选中了这个选项，那么数据就会被以硬件相关的密钥（key）加密，因此不能被传输到或者被其他设备看到。即使它们提供了进一步的安全性，使用它们可能不是一个好主意，除非你有
一个更好的理由不允许数据在备份之间迁移。</p>

<p>要从keychain中获取数据，可以用
NSString *accountName = [wrapper objectForKey:(id)kSecAttrAccount];</p>

<p><br></p>

<h2>使用Snoop-it分析Keychain读写</h2>

<p>一个用来分析写到Keychain中的非常棒的工具就是Snoop-it。如果你还不知道Snoop-it，请查阅本系列的<a href="http://wufawei.com/2013/11/ios-application-security-9/">第9篇关于Snoop-it文章</a>。现在在你的越狱设备上运行工程<a href="http://developer.apple.com/library/ios/">GenericKeychain</a>，然后用Snoop-it来分析它。本系列<a href="http://wufawei.com/2013/11/ios-application-security-7/">第7篇</a>介绍如何用自签名的证书来让应用运行。这个应用使用同样的例子工程来演示如何使用Objective-C的一个wrapper类KeychainWrapper来读写keychain。请确保这个应用正被Snoop-it分析。现在打开应用，我们将看到如下的界面。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/080513_1630_IOSApplicat2.png" alt="" /></p>

<p>现在随意输入用户名和密码然后保存。这里我们输入用户名为“Test User”，密码为“password”。你可以看到Snoop-it可以检测到keychain的任何变话，然后告诉我们
保存在keychain的信息。同时也会告诉我们保存的信息的保护级别（protectionn class)。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/080513_1630_IOSApplicat3.png" alt="" /></p>

<p>这里的信息给出了我们的用户名和密码。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/080513_1630_IOSApplicat4.png" alt="" /></p>

<p>现在输入账号。Snoop-it同样也能检测到。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/080513_1630_IOSApplicat5.png" alt="" /></p>

<p>你可以看到，Snoop-it也能购检测到对keychain数据库的操作。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/080513_1630_IOSApplicat6.png" alt="" /></p>

<p><br></p>

<h2>使用Keychain Dumper导出Keychain中的数据</h2>

<p>从Keychain中导出数据的最流行工具是ptoomey3的Keychain dumper。其github地址位于<a href="https://github.com/ptoomey3/Keychain-Dumper">此</a>。现在到这个地址把它下载下来。然后解压zip文件。在解压的文件夹内，我们感兴趣的文件是keychain_dumper这个二进制文件。一个应用能够访问的keychain数据是通过其entitlements文件指定的。keychain_dumper使用一个自签名文件，带有一个*通配符的entitlments，因此它能够访问keychain中的所有条目。 当然，也有其他方法来使得所有keychain信息都被授权，比如用一个包含所有访问组(access group)的entitlements文件，或者使用一个特定的访问组（access group）使得能够访问所有的keychain数据。
例如，工具<a href="https://code.google.com/p/iphone-dataprotection/wiki/KeychainViewer">Keychain-viewer</a>就使用如下的entitlements.</p>

<p>com.apple.keystore.access-keychain-keys</p>

<p>com.apple.keystore.device</p>

<p>现在把这个二进制文件上传到你的设备的/tmp文件夹，确保它可执行。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/080513_1630_IOSApplicat7.png" alt="" /></p>

<p>现在请确保保存在/private/var/Keychains/keychain-2.db的keychain文件可以被读取。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/080513_1630_IOSApplicat8.png" alt="" /></p>

<p>现在，运行这个可执行文件</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/080513_1630_IOSApplicat9.png" alt="" /></p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/080513_1630_IOSApplicat10.png" alt="" /></p>

<p>如你所见，它可以导出所有的keychain信息。你可以看到许多保存在这里的用户名和密码。例如，你可以看到Mail应用把你账号的用户名和密码保存在keychain中。
类似的，你也可以找到你之前连接过的无线网络的密码和其他更多的信息。上述命令默认只会导出通用和网络密码。你可以通过－h命令查看它的用法。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/080513_1630_IOSApplicat11.png" alt="" /></p>

<p>你可以通过 “-a” 命令导出所有数据</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/080513_1630_IOSApplicat12.png" alt="" /></p>

<p>使得keychain中的数据更安全的一个做法就是使用一个更强的口令。这是因为对某些特定的保护属性（protection attributes）来说，口令会被用作加密keychain中的数据。
iOS默认允许4位数字口令（从0-9999），因此很容易被人在几分钟之内暴力破解。本系列的后续文章中我们会看看暴力破解口令。设置字母加数字的密码会让破解花更多的时间。
一个合适的保护属性（protection attributes）和口令的组合会让keychain的数据更难被获取。</p>

<p><br></p>

<h2>总结</h2>

<p>在本文中，我们看到了从iOS设备的Keychain中导出数据是多么的容易。虽然在keychain中保存凭证（credentials）和敏感信息比NSUserDefaults和plist文件更安全，但是，
想要破解它也不难。</p>

<p>References</p>

<p>Keychain-Dumper
<a href="https://github.com/ptoomey3/Keychain-Dumper">https://github.com/ptoomey3/Keychain-Dumper</a></p>

<p><br/>
本文原文是 <a href="http://resources.infosecinstitute.com/ios-application-security-part-12-dumping-keychain-data/">IOS Application Security Part 12 – Dumping Keychain Data</a></p>

<p>注：之前我写过一篇文章，<a href="http://wufawei.com/2013/06/Keychain-is-not-safe/">Keychain is not safe</a>,大家可以对照着看看，有的应用还是在keychain中保存密码。虽然本文说keychain也容易被破解，不过比NSUserDefaults和plist安全得多，只要我们注意不要在keychain中保存明文密码就会在很大程度上提升安全性。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-15T00:00:00+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>ios</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/15/ios-application-security-11/" itemprop="url">iOS应用程序安全(11)-分析使用HTTP/HTTPS的网络流量</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>作者：Prateek Gianchandani<br/>
译者：吴发伟<br/>
原文网址：<a href="http://resources.infosecinstitute.com/ios-application-security-part-11-analyzing-network-traffic-over-httphttps/">http://resources.infosecinstitute.com/ios-application-security-part-11-analyzing-network-traffic-over-httphttps/</a><br/>
版权声明：自由转载-非商用-保持署名</p>

<p>在前面的文章中，我们分析了iOS文件系统和取证。本文我们将看看如何分析iOS设备上的网络流量。分析应用的网络流量会带来几个方面的好处。它可以帮助我们推断应用是如何管理用户会话的，我们应用调用的另一方是谁，以及应用程序内部是如何工作的等等。我们也会看看如何分析使用SSL的网络流量。</p>

<p>监听网络流量有主动和被动两种方式。如果你对远程分析一个网络中的特定设备的流量感兴趣，那你需要wireshark这个工具。打开Wireshark,开始嗅探网络，添加一个过滤器（fliter，例如 ip.addr == 192.168.1.2）以便它只显示你的设备发出或者接收的网络流量。如果你的无线网卡不够好，那么有些数据包可能会丢失。</p>

<p>如果你想要分析使用SSL的设备的网络流量，有许多方法可以达到目的，比如使用Arpspoof(ARP嗅探) 和SSLStrip的组合。不过，因为我们只对分析某个特定应用的网络流量感兴趣，我们将使用另一个不同的方法。先申明下，本文关注的是分析网络流量而不是劫持网络流量。并且，我们既能够分析通过Wi-Fi的流量，也能分析通过蜂窝网络(cellular)的流量。因为我们只是对分析某个特定应用的网络流量感兴趣，那选择哪种媒介（medium，这里指Wifi或者 celluar)事实上并不重要。</p>

<p><br></p>

<h2>使用TCPDump</h2>

<p>抓取设备上的网络流量的一个最基本技巧是使用tcpdump。首先，请确保你的设备上安装了tcpdump。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/073013_1821_IOSApplicat1.png" alt="" /></p>

<p>现在，开始在某个特定的接口上抓取数据并且输出到一个文件。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/073013_1821_IOSApplicat2.png" alt="" /></p>

<p>为了在使用蜂窝数据的时候抓取数据，仅仅需要把上述命令中的接口换成你的蜂窝链接对应的IP地址即可。</p>

<p>为了分析这个文件（抓包保存的文件），你可以把它传输到你的电脑上，然后用Wireshark分析。不过，正如你可能注意到的那样，这个过程确实很繁琐，通过Pipes
可以更好的完成这个过程。更多的信息请看<a href="http://wiki.wireshark.org/CaptureSetup/Pipes">这</a>。用tcpdump给了我们太多底层的信息，很多信息对我们从分析应用的数据的角度来说并不感兴趣。更好的方法是使用Burpsuite和Snoop-it。</p>

<p><br></p>

<h2>使用Snoop-it</h2>

<p>我们来看看如何通过Snoop-it来分析网络流量。顺便说一下，如果你还不知道Snoop-it是啥，请查看本系列文章关于Snoop-it的<a href="http://wufawei.com/2013/11/ios-application-security-9/">第9部分</a>。为了查看调用的api和网络请求，
打开在Snoop-it的任意应用然后查看最左边的网络部分。例如，下图展示了Snapchat应用的网络调用情况。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/073013_1821_IOSApplicat3.png" alt="" /></p>

<p>如果我们点击某个特殊请求，我们能够看到请求串的内容 ，比如body等等。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/073013_1821_IOSApplicat4.png" alt="" /></p>

<p><br></p>

<h2>使用Burpsuite监听HTTP</h2>

<p>再说一下，有许多方法能够查看网络的请求/相应，这其中Burpsuite是一个非常棒工具。可以从它的<a href="http://portswigger.net/burp/">官方网站</a>下载。下载它的免费版本就足够完成我们本文的任务了。
顺便说一下，如果你从来没有用过Burpsuite，请查看我写的关于Burpsuite的<a href="http://resources.infosecinstitute.com/burp-suite-walkthrough/">另一篇文章</a>。这里最主要的任务就是把Burpsuite当作一个代理，然后路由所有经过它的网络流量。</p>

<p>打开Burpsuite,到Proxy，选择Options</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/073013_1821_IOSApplicat5.png" alt="" /></p>

<p>点击已经设置的代理，点击编辑（edit），然后选择在Bind to Addrees这个选项的All Interfaces这个选项。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/073013_1821_IOSApplicat6.png" alt="" /></p>

<p>现在我们能够编辑代理监听的端口，甚至增加一个新的监听代理。Burp有个选项，能够把证书传递给使用SSL的网站。在安装的时候，Burp就默认的创建了一个自签名的CA证书。
现在选中的选项（如下图），“generate CA-signed per-host certificates” 就会用安装Burp的时候创建的CA证书给我们正在连接的host生成一个证书。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/073013_1821_IOSApplicat7.png" alt="" /></p>

<p>你会被提示一个警告。点击YES。我们选择绑定到所有接口的原因就是我们希望我们的iPhone能够用我们的电脑作为代理，因此选择绑定到本地接口是不够的。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/073013_1821_IOSApplicat8.png" alt="" /></p>

<p>现在，到Proxy－Intercept，然后确保Intercept设置成了off。这是因为你可能不想被每个通过这个代理的数据包打扰。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/073013_1821_IOSApplicat9.png" alt="" /></p>

<p>现在，你可以让你的设备把所有网络流量通过你的代理。在你的iOS设备上，到设置（Settinigs）app，选择Wifi，选择你目前正在连接的网络的设置，滚动到下面，
那里会有一个选项来设置代理。把代理地址设置成正在运行Burpsuite的电脑的IP地址，端口设置为代理运行的端口。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/073013_1821_IOSApplicat10.png" alt="" /></p>

<p>现在代理已经建立起来了，我们已经配置好我们的设备来使用这个代理，打开任意一个不是用SSL的应用（我们将会在本文的后面一点讨论SSL），然后随便用用让应用发出些网络请求。你可以在Burpsuite看到这些请求。下面就是NASA TV app的网络流量。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/073013_1821_IOSApplicat11.png" alt="" /></p>

<p>使用Burpsuite的好处就是我们能以原生的格式（raw）和十六进制（hex）的格式查看数据包，我们也可以查看参数（Params）和头（Headers）</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/073013_1821_IOSApplicat12.png" alt="" /></p>

<p>而且，我们也能够看到某个特定请求的对应返回包。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/073013_1821_IOSApplicat13.png" alt="" /></p>

<p>这给了我们详尽的细节来了解一个应用是如何与后台通信的，我们在调用谁，以及请求的格式是什么样的。</p>

<p><br></p>

<h2>使用Burpsuite监听HTTPS</h2>

<p>不过，上述的技巧对于那些使用HTTPS与后台通信的应用是不起作用的。有些应用只调用SSL连接。例如，如果你试图通过这个代理运行Snapchat就不会成功。不过，有些应用会跳出一个警告，然后让你确认或者取消这个连接。例如，如下图所示就是当通过代理运行Safari的时候的情况。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/073013_1821_IOSApplicat14.png" alt="" /></p>

<p>如果你点击继续，那么你就能够看到应用的网络流量。请注意，这个警告仅仅针对目前的host，如果你浏览到另一个使用HTTPS的网站，那另一个警告又会弹出来，
因为Burpsuite为每个host生成一个假的SSL证书。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/073013_1821_IOSApplicat15.png" alt="" /></p>

<p>每当我们通过Burpsuite连接一个HTTPS网站的时候，Burp会为每一个host生成SSL证书，这个证书是用我们自己的CA（Certificate Authority）证书签名的。为了确保不让这些警告每次都跳出，我们要在设备上把这个Burp的CA证书设置为受信任的根证书。因此，需要采取下述步骤。首先是得到这个根证书，然后把它安装到设备上。一旦它安装到设备上，它就是一个受信任的根证书它可以签名所有的证书，并且它签名的所有证书都是合法的。请注意这个证书的私钥(private key)保存在你的电脑上，因此当网络流量通过你电脑上的代理的时候，Burp就能够用这个私钥解密这些数据。这个根证书在你把Burp安装到系统的时候就已经被创建好了。</p>

<p>为了把这个根证书安装到你的系统上，首先配置你的浏览器使用Burpsuite 代理。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/073013_1821_IOSApplicat16.png" alt="" /></p>

<p>然后浏览使用SSL的网站，你会看到如下的一个警告</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/073013_1821_IOSApplicat17.png" alt="" /></p>

<p>现在我们的任务就是导出这个用来签名所有这些证书的根证书。对于gmail.com域名，我们不可能导出这个根证书，因为我们不能对gmail的域名添加例外。每个域名都可以实施这样的措施。不过，facebook允许我们添加一个例外。用Firefox访问facebook.com。你会看到一个警告，点击“了解这个风险”（Understanding the Risks）
然后点击添加例外（Add an Exception）</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/073013_1821_IOSApplicat18.png" alt="" /></p>

<p>然后，点击查看（view）</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/073013_1821_IOSApplicat19.png" alt="" /></p>

<p>点击Details标签，然后选择证书层次最上面的证书。这就是根证书。然后点击导出并保存后缀名为.crt的文件。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/073013_1821_IOSApplicat20.png" alt="" /></p>

<p>你也可以到Burp的文档找到这些步骤。下面就是[这个链接]<a href="http://portswigger.net/burp/help/proxy_options_installingCAcert.html"></a>的屏幕截图。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/073013_1821_IOSApplicat21.png" alt="" /></p>

<p>现在你就可以把这个文件发送到你的设备上。使用恰当的社会工程学技巧，攻击者就能够把这个证书安装到设备上，用户不会知道会有什么后果。
下面就是你打开这个证书的时候会得到的警告。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/073013_1821_IOSApplicat22.png" alt="" /></p>

<p>点击安装。你可以看到更详细的警告信息 。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/073013_1821_IOSApplicat23.png" alt="" /></p>

<p>点击完成（done）</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/073013_1821_IOSApplicat24.png" alt="" /></p>

<p>现在，既然这个根证书被认为是合法的，每个被这个根证书签名的证书都会被视为合法的，应用就会允许数据被传输。现在，之前不让我们用假的SSL证书传递数据的Snapchat应用允许我们成功的把数据传输出去。这个网络流量会被Burpsuite拦截。如下图所见，在登录调用的时候，我们可以看到用户名和密码和其他一些这个应用正在调用的API请求。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/073013_1821_IOSApplicat25.png" alt="" /></p>

<p><br></p>

<h2>总结</h2>

<p>本文我们学习了查看通过iOS设备的网络流量的不同方法。能够知道我们调用的对方是哪里，有哪些请求和响应，请求的头和参数是什么等等会帮助我们了解应用内部是如何工作的。</p>

<p><br/>
本文原文是 <a href="http://resources.infosecinstitute.com/ios-application-security-part-11-analyzing-network-traffic-over-httphttps/">IOS Application Security Part 11 – Analyzing Network Traffic over HTTP/HTTPS</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-15T00:00:00+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>ios</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/15/ios-application-security-10/" itemprop="url">iOS应用程序安全(10)-iOS文件系统和取证</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>作者：Prateek Gianchandani<br/>
译者：吴发伟<br/>
原文网址：<a href="http://resources.infosecinstitute.com/ios-application-security-part-10-ios-filesystem-and-forensics/">http://resources.infosecinstitute.com/ios-application-security-part-10-ios-filesystem-and-forensics/</a><br/>
版权声明：自由转载-非商用-保持署名</p>

<h2>引言</h2>

<p>我们将在本文分析iOS的文件系统，了解其目录是如何组织的，查看一些重要的文件，然后看看如何才能够从数据库文件和plist文件导出数据。我们将学习应用是如何在特定目录（沙盒）内存放数据的，以及怎样才能提取这些数据。</p>

<p>有一个很重要的事情需要注意，在前面的文章中，我们都是以root身份登录进设备的。设备上有另一个用户名叫mobile, 一个mobile用户拥有的权限是少于root用户的。除了Cydia和少数的应用以root权限应用之外，其他应用都是以mobile的身份应用的。有些苹果内部的daemon服务也以root权限运行。执行ps aux就可以查看清楚。在最左边，我们可以看到用户列。可以看到Cydia以root身份运行，所有其他应用都以mobile身份运行，
例如/Applications/AppStore.app/AppStore，有些demon也以root身份运行，如/usr/sbin/wifid。一些你通过Cydia安装的应用也可能会以root身份运行。
一旦你的设备一越狱，默认root和mobile的密码都是alpine.</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat1.png" alt="" /></p>

<p>可以配置一个应用以root权限运行。你可以看看Stack Overflow上的<a href="http://stackoverflow.com/questions/7841344/gaining-root-permissions-on-ios-for-nsfilemanager-jailbreak/8796556#8796556">这篇文章</a>来了解更多细节。</p>

<p>我们ssh进设备。到/Applications目录。你可以在该文件夹下看到一些应用。它们中的大多是都是iOS预装的，有些应用是通过Cydia安装的，比如Ternimal 应用。请注意，所有运行在/Applications的应用并不运行在沙盒环境，而所有在/var/mobile/Applications目录下的应用都运行在一个沙盒环境下。文章后面会讨论沙盒。不过，它们默认依然以mobile用户运行，除非专门做了配置。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/072913_1331_IOSApplicat2.png" alt="" /></p>

<p>所有从App Store下载的应用都位于/var/mobile/Applications目录。这个目录也包含用installipa或者其他外部源如Cydia安装的应用。所有这些应用都运行在沙盒环境下。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat3.png" alt="" /></p>

<p>请注意，从iOS4及以后，每个应用都驻留的环境叫做沙盒(Sandbox)。这样做的主要目的是不允许应用访问它自己沙盒外的任何数据。这样做会更安全。不过，应用用合适的权限是可以访问用户某些特定的用户数据的。例如要用户允许去访问联系人，照片等等。不过，对这些也有不少争论。
例如从iOS6开始，应用在得到用户允许之后才能访问用户的联系人。在这之前，应用不需要获得任何权限就能访问用户的联系人，这导致了较大的<a href="http://arstechnica.com/gadgets/2012/02/path-addresses-privacy-controversy-but-social-apps-remain-a-risk-to-users/">争议</a>，例如Path应用。</p>

<p>通过使用Entitlements，你可以访问沙盒外的好些东西。你可以读读这里的<a href="http://developer.apple.com/library/ios/">文档</a>。例如，要获得一个用户的calender的读权限，.entitlements文件中的entitlement key com.apple.security.personal-information.calendars必须标志为YES。</p>

<p>让我们看看某个特定应用的目录结构。首先到Snapchat的目录看看。对于所有应用都是类似的结构。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat4.png" alt="" /></p>

<ul>
<li>Snapchat.app(应用名称.app)文件夹包含所有的资源文件(images)，plist文件和应用的二进制文件。</li>
<li>Documents目录用于存放任意文件。相对于应用文件来说，这提供了一个只能在应用内访问的单独目录。下面是从<a href="https://developer.apple.com/library/mac/navigation/">苹果文档</a>中摘录的一句话。</li>
</ul>


<p>&ldquo;把用户数据放到/Documents/。用户数据是你的应用不能再创建的任意数据，比如用户的文档或者任何其它用户产生的内容“。</p>

<ul>
<li>tmp文件夹用于存放用户的临时数据。应用的开发者有责任释放被改文件夹占有的内存.</li>
<li><p>Library文件夹可以用来保存那些不是用户数据的文件。</p>

<p>你可以从下面的<a href="http://developer.apple.com/library/mac/">苹果文档</a>的截图知道更多信息。</p></li>
</ul>


<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat5.png" alt="" /></p>

<h2>从数据库中收集信息</h2>

<p>苹果用sqlite数据库存了很多信息。这些数据库数据库通常以.db或者.sqlitedb结尾。对于开发者来说，许多功能比如Core Data， NSUserDefaults都从一个较低的层次操作这些sqlite数据库。可以从这些数据库抽取出特定应用，甚至操作系统级别的许多信息。可能包括电话历史或者应用内保存的邮件等等。要找到所有的.db文件，
可以用命令 find . -name *.db</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat6.png" alt="" /></p>

<p>你可以得到在设备上保存的所有数据库文件。让我们先看下其中的一些重要数据库文件。</p>

<p>我在设备上安装了gmail应用。下面这个文件对我来说看起来很有趣。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat7.png" alt="" /></p>

<p>看起来这个文件包含了一些重要的信息。让我们先用sqlite客户端分析一下这个文件。请注意，你需要在你的设备上安装sqlite客户端，比如sqlite3。
我们先打开设备，然后用命令sqlite3 file_name打开数据库文件。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat8.png" alt="" /></p>

<p>请注意，你会得到一个sqlite解释器。让我们打开headers，这样我们就可以看到所有的列表名称。你可以用.tables命令看看数据库存放的所有表。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat9.png" alt="" /></p>

<p>有些表看起来很有趣，比如cached_contacts, cached_queries 和 cached_messages。让我们从cached_messages导出所有信息。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat10.png" alt="" /></p>

<p>正如我们看到的那样，导出了所有缓存了的邮件。</p>

<p>类似的，我们也可以导出所有的短信（SMS）数据库，位于/private/var/mobile/Library/SMS.你可以从导出文件中看到一条消息，
其文本是Test message for ios security tutorial</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat11.png" alt="" /></p>

<p>另一个例子是联系人数据库，其位置是 /var/mobile/Library/AddressBook</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat12.png" alt="" /></p>

<p>你也可以查看电话历史记录，位于 /private/var/wireless/Library/CallHistory</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat13.png" alt="" /></p>

<p>有时候用命令行做这些事情确实很费时间。一个更好的分析方法就是导出这些信息到你电脑上，（然后用工具打开）。例如，
下载 Address Book Sqlite database</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat14.png" alt="" /></p>

<p>我们可以用GUI Sqlite客户端工具来分析这个文件。我这里用的是MesaSQLite。免费且易用。
在MesaSQLite中，先到File，然后点击Open Database，选择db文件，然后在Content tab，选择一个表然后点击查看所有（Show All）</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat15.png" alt="" /></p>

<p>如你所见，许多信息都可以从这些数据库文件中获取。我推荐你自己去探索下，找找其他应用甚至操作系统的数据库文件看看。</p>

<p><br></p>

<h2>从plist文件中获取信息</h2>

<p>plist是用户存放许多不同设置和配置的结构化文本文件。因为这些信息都是以key-value这种键值对来存放信息的，所以要改变这些信息非常容易。因此，许多开发者有时会在这些文件中存放许多不该存放在这的信息。</p>

<p>即使在一个没有越狱的设备上，plist文件也可以通过工具iExplorer获取。你可以用iExlorer看看plist文件。例如如下图是一个Defcon iOS应用的plist
中存放的信息。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat16.png" alt="" /></p>

<p>下图是Snapchat应用的Documents目录中保存的plist文件截图。第一个高亮的区块实际上是特定用户的认证标识(authentication token)，第二个高亮的区块是
Snapchat的用户名称。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat17.png" alt="" /></p>

<p>Plist文件也可能包含机密信息，比如用户名和密码。<strong>有一个事情需要特别注意的就是，任何人都可以从设备中导出plist文件，即使这个设备没有越狱。
你也可以从用户的iTunes 备份中导出这些plist文件。过去数年，有开发者把机密数据存放在plist文件中，这是不正确的做法。</strong>
Linkedin iOS应用被发现的一个漏洞就是它把用户的认证信息存放在plist文件中，你可以到<a href="http://blog.scoopz.com/2012/04/07/linkedin-ios-app-also-vulnerable-to-plist-identity-theft/">这</a>找到更多信息。</p>

<p>如果你想在terminal看这些plist文件，你可以先用工具plutil把它转化为xml格式，命令是  plutil -covert xml1 [filename]。首先用下面的2个命令找到设备上所有的plist文件。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat18.png" alt="" /></p>

<p>然后把它转成xml格式</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat19.png" alt="" /></p>

<p>现在文件是结构化的格式了，我们可以用vim打开它。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/072913_1331_IOSApplicat20.png" alt="" /></p>

<p>如你所见，我们现在能够分析plist文件的内容。</p>

<p><br></p>

<h2>总结</h2>

<p>在本文中，我们查看了iOS的文件系统，学习到其目录结果是如何组织的，查看了一些重要文件，并且学习了如何从数据库和plist文件中导出重要数据。在接下来的文章中，我们将用在前面一系列文章中学到的各种技术对一个例子应用进行详尽的安全分析。</p>

<p><br/>
本文原文是 <a href="http://resources.infosecinstitute.com/ios-application-security-part-10-ios-filesystem-and-forensics/">IOS Application Security Part 10 – IOS Filesystem and Forensics</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-14T00:00:00+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>ios</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/14/ios-application-security-9/" itemprop="url">iOS应用程序安全(9)-用Snoop-it分析iOS应用的安全</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>作者：Prateek Gianchandani<br/>
译者：吴发伟<br/>
原文网址：<a href="http://resources.infosecinstitute.com/ios-application-security-part-9-analyzing-security-of-ios-applications-using-snoop-it/">http://resources.infosecinstitute.com/ios-application-security-part-9-analyzing-security-of-ios-applications-using-snoop-it/</a><br/>
版权声明：自由转载-非商用-保持署名</p>

<h2>引言</h2>

<p>在前面的文章中我们介绍了如何用class-dump-z来导出iOS应用的类信息，如何利用Cycript挂钩进程、执行运行时操纵和method swizzling，用gdb分析app的流程。
然而，可能有更好的方式能够做这些事。如果能够有一个工具能够做所有这些事情并且能够更好的展示这些信息就太好了。</p>

<p>Snoop-it就是这样一个tool。它允许我们进行运行时分析和对iOS应用进行黑盒安全评估。它提供一个非常简洁的web界面。在写本文的时候，Snoop-it还没正式发布，我给作者写了邮件，
他们非常友好的提供给我一个beta版本做测试。你可以到它的<a href="https://code.google.com/p/snoop-it/">官网</a>查看或者你可以在<a href="http://twitter.com/aykay/">Twitter</a>上关注作者。</p>

<p>Snoop-it提供的功能可以从对其<a href="https://code.google.com/p/snoop-it/">官方地址</a>的截图看到。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat1.png" alt="" /></p>

<p><br></p>

<h2>安装</h2>

<p>（备注：目前已经可以通过在Cydia上添加源、然后直接下载安装了。）
要安装Snoop-it到你的设备上。你不得不下载deb包，然后用sftp上传到你的设备上。在命令行下用命令dpkg -i [packageName]来安装Snoop-it到你的设备上。
一旦安装完成，重启你的设备。</p>

<p><img src="http://2we26u4fam7n16rz3a44uhbe1bq2.wpengine.netdna-cdn.com/wp-content/uploads/071813_1302_IOSApplicat2.png" alt="" /></p>

<p>一旦安装完成，你会看到Snoop-it的图标，点击它，你可以看到如下的界面。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat3.png" alt="" /></p>

<p>到设置中按你所需配置。在这里，我们选择端口为12345，并且关闭验证。如果你所在的网络有许多其他用户，或者比较调皮的用户，建议你还是开启验证。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat4.png" alt="" /></p>

<p>现在，用Snoop-it提供的地址打开Snoop-it的Web界面。在我这，地址是：<a href="http://10.0.1.79:12345">http://10.0.1.79:12345</a></p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat5.png" alt="" /></p>

<p>你将看到这个Web界面。如果你读一下，会发现它让你在Snoop-it中选择你要分析的应用，在应用中打开要分析的应用，然后刷新这个Web界面。现在回到
Snoop-it，选择我们要分析的应用，在我这，我将要选择MethodSwizzlingDemo应用，和上一篇文章用的应用一样。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat6.png" alt="" /></p>

<p>请确保要分析的应用已经打开并保持在前台，现在刷新Snoop-it的Web界面。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat7.png" alt="" /></p>

<p>正如你看到的，现在你有一个很漂亮的界面，现在你可以对这个应用进行详尽的安全评估了。</p>

<p><br></p>

<h2>分析</h2>

<p>在左边，在Analysis下面，点击Objective-C Classes。在右边你就看到所有的类信息，比如属性和方法名称。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat8.png" alt="" /></p>

<p>橘子色的代表有实例的类。例如，当你把鼠标从ViewController的类上面移动的时候，你会看到一个类实例的信息。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat9.png" alt="" /></p>

<p>类似的，那可以看到AppDelegate的方法和属性。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat10.png" alt="" /></p>

<p>回到View Controller上面来，我们可以通过Snoop-it调用方法。点击右上角的 Setup and Invoke。正如我们在上一篇文章中提到的那样，使用这个方法，我们能够绕过这个应用
的验证。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat11.png" alt="" /></p>

<p>选择对应的实例（这里只有1个实例，但是如果view controller被复用，那么就可能会有多个实例），点击Invoke Method.</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat12.png" alt="" /></p>

<p>这样我们就调用了对应的方法，并且绕过了程序的验证。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat13.png" alt="" /></p>

<p>Snoop-it的另一个牛逼功能是我们可以切换到任意的view controller。例如，在左边的Analysis下面，选择View Controller，选择右边的view controller，然后点击Display Controller.
你就能够切换到那个view controller。你也可以根据这个View Controller是否在另一个View controller上面来决定点击Close/Hide View Controller。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat14.png" alt="" /></p>

<p>你能够通过点击 Reset display返回。这个功能能够让我们把view controller与对应的view关联起来。我太喜欢Snoop-it的这个功能了。</p>

<p><br></p>

<h2>运行时修改</h2>

<p>Snoop-it支持多种运行时修改，包括修改你的硬件标识符比如Mac地址，UDID，设备模型号等等。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat15.png" alt="" /></p>

<p>你还可以弄个假地址。这个对于那些利用GeoEncrytion来保护它们数据的应用来说 非常有用。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat16.png" alt="" /></p>

<p>而且，你还可以跟踪方法和系统调用的流程。请注意，你需要每隔几秒在方法调用后点击最上面的Refresh刷新一下。请注意，因为我们在beta版本上测试，可能作者会改变这个行为使得我们不必每隔几秒就点击刷新按钮。对有些用户来说，这些信息可能太多，但是对于像我一样已经开发过多年iOS程序的人来说这些信息是相当简单直接的。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat17.png" alt="" /></p>

<p><br></p>

<h2>监控</h2>

<p>Snoop-it允许你查看哪些文件和目录目前正被应用访问。为了达到这个目的，请点击Monitoring下面的 Filesystem.这个功能特别有用，尤其是当应用正在往db写数据的时候，这个功能能够让你找出db文件的名字。你也可以双击它们，然后下载到你的机器上再分析。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat18.png" alt="" /></p>

<p>你也可以看到应用调用的敏感API。比如在地址簿查找信息，访问camera，或者访问设备的UDID。下面是预装的App Store应用访问的敏感API</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/071813_1302_IOSApplicat19.png" alt="" /></p>

<p>我们也可以看到这个应用存在keychain的所有信息。它也会列出所有通过NSURLConnection访问的HTTP请求。这两个功能都可以在monitoring下面看到。我把这些功能留给读者你去尝试。
我们将在另一篇文章中介绍如何从keychain中dump出数据。</p>

<p>你会很高兴的知道Snoop-it有公共的API，所以我们能够利用它来编写自动化测试或者编写我们自己的用户界面。关于XML-RPC web service API的文档可以在<a href="http://code.google.com/p/snoop-it/wiki/">官网</a>找到。</p>

<p><br></p>

<h2>总结</h2>

<p>本文我们学习了如何使用Snoop-it来进行运行时分析和对iOS apps进行黑盒安全评估。 Snoop-it离发布还有几个星期的时间，尽管你可以像我一样向作者发邮件索要beta版本。
有一个我特别想要Snoop-it添加的功能就是执行Method Swizzling。我确信Snoop-it对于任何对iOS应用的安全分析感兴趣的人都是一个好工具，并且它会变得越来越好。</p>

<p>（注：翻译的时候已经发布了，可以在Cydia上下载，需要先添加源，具体参见其官方网站）</p>

<p><br/>
本文原文是 <a href="http://resources.infosecinstitute.com/ios-application-security-part-9-analyzing-security-of-ios-applications-using-snoop-it/">IOS Application Security Part 9 – Analyzing Security of IOS Applications using Snoop-it</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-14T00:00:00+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>ios</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/14/ios-application-security-8/" itemprop="url">iOS应用程序安全(8)-用Cycript进行Method Swizzling</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>作者：Prateek Gianchandani<br/>
译者：吴发伟<br/>
原文网址：<a href="http://resources.infosecinstitute.com/ios-application-security-part-8-method-swizzling-using-cycript/">http://resources.infosecinstitute.com/ios-application-security-part-8-method-swizzling-using-cycript/</a><br/>
版权声明：自由转载-非商用-保持署名</p>

<h2>引言</h2>

<p>在前面的文章当中，我们学习了如何在没有开发者证书的情况下安装自己的应用。本文我们将在一个例子程序上看如何用Cycript做method Swizzling。</p>

<p>第一件事情就是下载Xcode例子工程。你可以从<a href="https://dl.dropboxusercontent.com/u/34557464/MethodSwizzlingDemo.zip">这</a>下载。或者你也可以从<a href="https://dl.dropboxusercontent.com/u/34557464/MethodSwizzlingDemo.ipa">这</a>下载二进制文件。如果你已经安装了Xcode，你可以用自签名证书来构建这个工程。上一篇文章详细介绍了如何做。如果你下载了ipa文件，你可以直接把它安装到你的越狱设备上。
推荐你下载Xcode例子工程，看看源代码。</p>

<p>请确保使用你自己的证书来签名。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat1.png" alt="" /></p>

<p>一旦你让这个app在设备上运行起来，ssh进设备，然后用Cycript挂钩这个进程。
你可以通过命令cycript -p [app_id] 来挂钩进入任意进程。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat2.png" alt="" /></p>

<p>如你所见，这个app有一个登录框。请注意在本文中，我们只会在点击 Login Method 1这个按钮的时候绕过登录。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat3.png" alt="" /></p>

<p>用户名和密码是 admin:password。登录后可以进入管理页面。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat4.png" alt="" /></p>

<p>如果输入的用户名和密码有误，那会得到一个错误提示。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat5.png" alt="" /></p>

<p>我们的目标就是绕过这个登录view。</p>

<p>首先，我们先找到这个应用对用的root view controller.在cycript中用下面的命令
UIApp.keyWindow.rootViewController</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat6.png" alt="" /></p>

<p>既然我们在应用中看到的第一个视图就是这个登录页面，我们可以确定负责显示这个视图的view controller是我们用前一个命令找到的navigation controller的一部分。我们可以用navigation controller的visibleViewController属性来找到当前的视图。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat7.png" alt="" /></p>

<p>完美。现在让我们写个函数打印出该view controller的所有方法吧。这个方法是从Cycript技巧页面拿过来用的。我建议你仔细看看这个页面，能发现很多不错的代码。</p>

<p>下面就是我用的代码。</p>

<pre><code>1. function printMethods(className) {
2. var count = new new Type("I");
3. var methods = class_copyMethodList(objc_getClass(className), count);
4. var methodsArray = [];
5. for(var i = 0; i &lt; *count; i++) {
6. var method = methods[i];
7. methodsArray.push({selector:method_getName(method), implementation:method_getImplementation(method)});
8. }
9. free(methods);
10. free(count);
11. return methodsArray;
12. }
</code></pre>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat8.png" alt="" /></p>

<p>现在让我们打印出当前view controller的所有方法。请注意这个函数取的是类名，在这里是ViewController</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat9.png" alt="" /></p>

<p>获取方法名称的另一个方法就是使用isa.messages属性。根据苹果的<a href="http://developer.apple.com/library/ios/">官方文档</a>，isa是一个指向类结构的指针。</p>

<p>下面是从同一页摘取的文字。</p>

<blockquote><p>“当一个新对象创建的时候，其内存会被分配，实例变量会被初始化。在对象的变量里面第一个就是一个指向它的类对象的指针。这个指针，叫做isa, 使得
这个对象能够访问它的类，通过这个类，能够找到所以它继承自的类。”</p></blockquote>

<p>下面这个来自<a href="http://developer.apple.com/library/ios/">苹果文档</a>的图解释得很清晰。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat10.png" alt="" /></p>

<p>所以，什么是messages属性呢？首先我们必须要知道什么是分发表（dispatch table）。分发表包含了很多条目，这些条目关联方法的selector和方法在类的地址。
让我们看一下从苹果官方的截图。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat11.png" alt="" /></p>

<blockquote><p>“给一个对象发送消息的时候，消息函数会根据对象的isa指针到类结构中的分发表查找对方的方法选择器（method selector）。如果没有找到，那objc_msgSend用这个指针找到其superclass，然后查找superclass
的分发表。连续的查找失败会让objc_msgSend一直依次查找类层次直到NSObject。一旦它定位到选择器（selector），objc_msgSend就调用表中的这个方法并且把它接收的对象数据结构传递给它。
这就是在运行时选择方法实现的方法。或者用面向对象编程的术语，这些方法和消息是动态绑定的。”</p>

<p>现在，很容易就能猜到messages属性是能发给类实例或者类本身的方法的消息列表。这将是一个非常大的列表，因为isa指针会选择从它父类一直到NSObject的消息。上面有一行值得特别注意。
“这就是在运行时选择方法实现的方法。或者用面向对象编程的术语，这些方法和消息是动态绑定的。”</p></blockquote>

<p>因为方法和消息是在运行时绑定的，所以我们能够更改某个特定消息的方法实现。</p>

<p>在这里，让我们打印出App Delegate类的所有消息。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat12.png" alt="" /></p>

<p>直接使用messages属性也一样可以。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat13.png" alt="" /></p>

<p>在这里，我们关心的时候用来显示登录页的view controller，我们之前就发现它的名称为ViewController.所以打印出这个VC的所有消息。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat14.png" alt="" /></p>

<p>在输出的顶部，你可以看到这个VC的一些方法。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat15.png" alt="" /></p>

<p>方法validateLogin看起来很有趣。让我们看看class-dump-z输出的关于这个方法的信息。如果你对class-dump-z不熟悉，请参看本系列的<a href="http://wufawei.com/2013/11/ios-application-security-2/">第2篇文章</a>。</p>

<p>下面就是我们从class-dump-z的输出中找到的关于ViewController的相关信息。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat16.png" alt="" /></p>

<p>正如我们看到的，方法validateLogin返回一个BOOL类型值。从这我们可以推断这个方法验证用户的用户名和密码是否正确，正确返回YES，否则返回NO。
有Cycript在手，我们可以改变某个特定消息的实现。让我们来实现一个方法让它总是返回TRUE。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat17.png" alt="" /></p>

<p>因此，R.H.S （Right Hand Side）是一个javascript函数，总是返回true。让我们现在点击应用的登录页面的Login Method 1。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat18.png" alt="" /></p>

<p>可以看到，认证成功，应用让我们进入管理页面了。我们使用Cycript执行了method swizzling，绕过了登录框。</p>

<p><br></p>

<h2>一些其他有趣的事情。</h2>

<p>现在我们看到method swizzling是如何工作的，去了解下绕过这个验证的其他方法也会非常有趣。从class-dump-z的输出结果，我们可以看到一旦validateLogin返回TRUE。方法pushLoginPage就会被调用。其他一些页面可能叫做pushUserPage, 或者pushLoginSuccessfulPage等等。我们不必需要验证一定要是TRUE。我们可以自己调用这个方法。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1533_IOSApplicat19.png" alt="" /></p>

<p>因为这是个实例方法，我们通过UIApp.keyWindow.rootViewController.visibleViewController 得到实例。请注意这样做可能导致crash，因为后续被push进的view controller
可能对输入的用户名和密码有依赖。如果你想挑战一下，不妨试试绕过Login Method 2。我们会在随后的文章讨论如何绕过它。</p>

<p><br></p>

<h2>总结</h2>

<p>本文我们学习了如何利用Cycript来进行method swizzling。随后我们将讨论更多自动化的技巧和更好的工具。我们将看看如何在运行时使用gdb和otool来获得其他信息。</p>

<p><br/>
本文原文是 <a href="http://resources.infosecinstitute.com/ios-application-security-part-8-method-swizzling-using-cycript/">IOS Application Security Part 8 – Method Swizzling using Cycript</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-14T00:00:00+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>ios</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/14/ios-application-security-7/" itemprop="url">iOS应用程序安全(7)-不用证书安装应用到设备的方法</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>作者：Prateek Gianchandani<br/>
译者：吴发伟<br/>
原文网址：<a href="http://resources.infosecinstitute.com/ios-application-security-part-7-installing-and-running-custom-applications-on-device-without-a-registered-developer-account/">http://resources.infosecinstitute.com/ios-application-security-part-7-installing-and-running-custom-applications-on-device-without-a-registered-developer-account/</a><br/>
版权声明：自由转载-非商用-保持署名</p>

<h2>引言</h2>

<p>通常情况下，如果你要在设备上测试应用，你需要每年花99美元注册成为开发者。对于想要学习iOS应用安全的人来说，能够在设备上运行并测试应用非常重要。对于不想在app store发布任何程序的人来说，每年99美元并不值得。本文我们将看看在没有注册成为开发者账号的情况下，如何在越狱设备上构建和安装应用。在接下来的文章中，我们将看看如何在设备上运行我们自己的应用，使用Cycript来做method swizzling和其它一些技巧。</p>

<p>本文将使用Xcode 4.5.2，设备是iOS5.1的系统。同样的技巧可能在其他版本的的iOS或者Xcode有效，但是也不一定。如果你在运行应用的时候遇到同样的问题，请留言，我会尽快回复。</p>

<p>第一步是创建一个自签名的证书。我们将使用这个证书来签名我们的应用。</p>

<p>打开Keychain Access应用。点击keychain Access -> Certificate Assistant -> 创建一个证书</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat1.png" alt="" /></p>

<p>命名这个证书，在这里我们命名为 Prateekg, 选择证书类型为 Code Signing, 不要选中 Let me override defaults。
点击创建和继续按钮。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat2.png" alt="" /></p>

<p>如你所见，我们证书已经创建好了。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat3.png" alt="" /></p>

<p>现在把文件从/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Info.plist的Info.plist文件复制到桌面。这么做的原因是我们要编辑这个文件，但是在原位置是不能这么做的。因此，我们需要先复制到桌面，编辑后，再拷贝回原来位置。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat4.png" alt="" /></p>

<p>打开桌面上的文件</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat5.png" alt="" /></p>

<p>在这个文件中，把所有的XCiPhoneOSCodeSignContext 替换为 XCCodeSignContext，保存。现在你可以看到文件内容如下：</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat6.png" alt="" /></p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat7.png" alt="" /></p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat8.png" alt="" /></p>

<p>现在把这个文件放回原来的位置。你可能需要相应的权限才能这么做。我用的命令是
sudo cp /Users/prateekgianchandani/Desktop/Info.plist /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Info.plist</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat9.png" alt="" /></p>

<p>现在是时候创建一个例子工程了。打开Xcode, 点击创建一个新的Xcode项目，选择单视图应用。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat10.png" alt="" /></p>

<p>你可以随意命名，这里我们命名为SelfSignedApp,点击下一个，然后点击继续。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat11.png" alt="" /></p>

<p>因为我们将要在运行iOS 5.1的设备上运行，我们需要确保部署目标是对的。在左上的项目导航区选择工程名字，然后在Info里面，
设置部署目标为5.1，如下图所示。你可以根据你的设备运行的操作系统版本来选择部署目标。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat12.png" alt="" /></p>

<p>因为我们在iOS 5.1上运行，并且我们用了Storyboard，但是iOS5.1并不支持Autolayout，请确保Use Autolayout选项没有被选中。
否则程序可能会因此crash。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat13.png" alt="" /></p>

<p>现在开始拖放label到storyboard，在上面写些文字。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat14.png" alt="" /></p>

<p>现在我们要让Xcode用我们自己生成的证书去签名。在左上的项目导航区选择工程名字，然后在Build Settings中选择我们生成的证书。如果因为某些原因，在下拉框中并没有显示我们的证书，请重启Xcode。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat15.png" alt="" /></p>

<p>现在选择我们的应用要运行的设备。如果设备并没有在列表中显示，请到Organizer－> Devices -> 你的设备，选择  Use for development.</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat16.png" alt="" /></p>

<p>选择设备之后，点击运行，你会得到如下图的一个警告。点击总是允许。你可能会被提示设备或者Xcode错误，那请断开设备连接，重新打开Xcode，再次运行，这样应用就能部署到设备上。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat17.png" alt="" /></p>

<p>也有其他方法让应用能够在设备上运行。构建应用，然后Xcode会在一个特定的目录创建一个.app文件。
默认地址是：/Users/$[YOUR_USER_NAME]/Library/Developer/Xcode/DerivedData/$[YOUR_APP_NAME_APP_ID]/Build/Products/Debug-iphoneos/. 在我的系统上，地址是：/Users/prateekgianchandani/Library/Developer/Xcode/DerivedData/SelfSignedApp-bfzixtyoynrxxlgigskifizrfqqw/Build/Products/Debug-iphoneos/</p>

<p>用下面的命令复制这个.app文件到桌面上
mv /Users/$[YOUR_USER_NAME]/Library/Developer/Xcode/DerivedData/$[YOUR_APP_NAME_APP_ID]/Build/Products/Debug-iphoneos/SelfSignedApp.app /Users/$[YOUR_USER_NAME]/Desktop/</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat18.png" alt="" /></p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat19.png" alt="" /></p>

<p>现在创建一个目录叫做Payload,然后把SelfSigned.app放到里面。然后压缩Payload目录（压缩文件会被命名为
Payload.zip）然后重命名Payload.zip为SelfSigned.ipa. 从这个系列的第2篇文章可以看到，这就是iOS应用保存的包。</p>

<p>一旦我们有这个ipa文件，我们有2种方法来安装它。第一种就是直接把这个ipa拖到iTunes的apps部分，然后用iTunes把应用安装到设备上。</p>

<p>另一个方法就是用sftp把ipa上传到设备上，然后用一个叫做installipa的工具来安装它。可以通过Cydia来下载installipa.</p>

<p>用sftp上传ipa文件到设备</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat20.png" alt="" /></p>

<p>然后用ssh登录，在命令行用installipa安装</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070813_1648_IOSApplicat21.png" alt="" /></p>

<p>这样就可以把应用安装到你的设备上了。你可能需要重启设备来让应用正常工作。</p>

<h2>总结</h2>

<p>本文我们介绍了如何在没有开发者证书的情况下把应用安装到越狱设备上。接下来，我们将用这些技巧来把我们的应用安装到设备上，然后在设备上做各种测试。</p>

<p><br/>
本文原文是 <a href="http://resources.infosecinstitute.com/ios-application-security-part-7-installing-and-running-custom-applications-on-device-without-a-registered-developer-account/">IOS Application Security Part 7 – Installing and Running Custom Applications on Device without a registered developer account</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-14T00:00:00+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>ios</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/14/ios-application-security-6/" itemprop="url">iOS应用程序安全(6)-iOS 7的新安全功能</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>作者：Prateek Gianchandani<br/>
译者：吴发伟<br/>
原文网址：<a href="http://resources.infosecinstitute.com/ios-application-security-part-6-new-security-features-in-ios-7/">http://resources.infosecinstitute.com/ios-application-security-part-6-new-security-features-in-ios-7/</a><br/>
版权声明：自由转载-非商用-保持署名</p>

<h2>引言</h2>

<p>我们都知道，苹果在WWDC 2013介绍了新的iOS系统,有着完全重新设计的用户界面。如果你还没看过，请看看WWDC 2013的视频。</p>

<p>与本系列的其他文章相比，我们在本文将稍微偏离下主题。在本文中，我们将介绍在iOS7中引入的新安全功能。</p>

<p><br></p>

<h2>获得 iOS7</h2>

<p>为了获得iOS 7 beta，你需要是一名注册的苹果开发者。到<a href="http://developer.apple.com%EF%BC%8C%E7%94%A8%E4%BD%A0%E6%B3%A8%E5%86%8C%E7%9A%84%E8%8B%B9%E6%9E%9Cid%E7%99%BB%E9%99%86%EF%BC%8C%E7%84%B6%E5%90%8E%E8%B7%B3%E8%BD%AC%E5%88%B0">http://developer.apple.com%EF%BC%8C%E7%94%A8%E4%BD%A0%E6%B3%A8%E5%86%8C%E7%9A%84%E8%8B%B9%E6%9E%9Cid%E7%99%BB%E9%99%86%EF%BC%8C%E7%84%B6%E5%90%8E%E8%B7%B3%E8%BD%AC%E5%88%B0</a><a href="https://developer.apple.com/devcenter/ios/index.action">这个地址</a>。然后点击并下载iOS 7 SDK。这样你就可以下载最新的iOS 7 beta版本了。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070113_1824_IOSApplicat1.png" alt="" /></p>

<p>下面是一些随着iOS 7一起介绍的安全功能</p>

<p><br></p>

<h2>激活锁</h2>

<p>在以前，如果用户丢失了他们的iPhone，他们可用“查找我的iPhone”，用GPS来跟踪他们的手机。不过这个流程有个非常大的问题。即使是一个不那么警觉的小偷，也会对设备执行恢复出厂设置，这样所有的内容和设置都会被擦除。然后，有了新的激活锁这个功能，要执行恢复出厂设置，就需要知道用户的苹果id对应的密码。</p>

<p>要验证这个功能，请到设置，然后是通用，滚动到底部，你可以看到一个重置按钮。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070113_1824_IOSApplicat2.png" alt="" /></p>

<p>如果你点击这个按钮，然后点击擦除所有内容和设置，你会看到一个弹出框，要求你输入苹果id对应的密码。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070113_1824_IOSApplicat3.png" alt="" /></p>

<p>这是一个非常方便灵活的功能，可以防止小偷重置你的iPhone的内容和设置。不过我们确定当这个公布以后，迟早会有人找到绕过这个功能的方法。你如果想去iCloud的设置关闭查找我的iPhone，也会得到同样的弹出框。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070113_1824_IOSApplicat4.png" alt="" /></p>

<p>正如我们看到的，要求我们输入苹果id对应的密码。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070113_1824_IOSApplicat5.png" alt="" /></p>

<p><br></p>

<h2>Airdrop传输的数据加密</h2>

<p>Airdrop使得你能够简单点击几下就能与周围人分享文件。Airdrop是iOS 7中引入的。好消息是，这些传输的文件都是加密过的。默认这项功能只对你的联系人可见。不过你也可以更改这个设置。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070113_1824_IOSApplicat6.png" alt="" /></p>

<p><br></p>

<h2>第三方应用数据保护</h2>

<p>数据保护依赖于支持硬件加密的设备，支持的设备从iPhone 3Gs开始。根据苹果的<a href="http://support.apple.com/kb/ht4175">官方文档</a>，数据保护通过用你的密码来保护硬件加密秘钥，增强了内建的硬件保护。对邮件地址和附件来说，提供了另一层的保护。从iOS 4开始，第3方应用就可以使用数据保护APIs来保护应用的数据。</p>

<p>在iOS 6，你可以到设置-通用-密码来选择一个密码，你可以看到底部有个文本，说数据保护已经启用。这意味着苹果在iOS6中默认对它自己的应用开启了数据保护这个功能。</p>

<p><img src="http://resources.infosecinstitute.com/wp-content/uploads/070113_1824_IOSApplicat7.png" alt="" /></p>

<p>在以前，开发者不得不使用数据保护API来保护应用数据。现在，在iOS7中，所有的第3方应用都自动开启了数据保护，这意味着用户解锁设备之前，所有应用内部的数据都是安全的。 我们知道，默认的，苹果允许4位数字密码，这个很容易被暴力破解。因此，为了安全，推荐使用更安全的密码。</p>

<p><br></p>

<h2>游戏中心的安全改进</h2>

<p>如果你经常在iOS上玩游戏，并且经常用游戏中心来与朋友竞争或者查看分数，你可能会看到某些特定游戏的不同寻常的高分数。通常情况下，这些都不是合法的分数，这些是黑客利用API的漏洞或者在运行时修改应用的变量才有高分数。在iOS 7中，苹果现在允许开发者确保这种破坏数据的情况不再发生。现在，开发者可以为每个游戏设置一个最高分数。这样，有着不寻常高分数的人，其数据会被上传保存到服务器，却不会显示在排行榜上。开发者随后可以决定是否让这些不同寻常的高分显示。苹果同时也为开发者增加了工具，使得开发者能够检查用户的可疑行为，在这种情况下，可以封锁这个用户。苹果也集成了签名过的游戏中心提交，这意味着苹果能够拒绝这些分数，如果苹果确信这些分数被别人修改过。不确定苹果是怎么做到这点的。</p>

<p><br></p>

<h2>iCloud Keychain</h2>

<p>大部人可能都使用过safari的自动填写功能。在iOS7上，Safari现在可以记住更多信息，例如用户名，密码，信用卡号等等，并且把这些信息保存在keychain中。然后它就会在用户访问网页的时候自动填写。所有这些信息都是用256位的AES加密算法加密了的。这个keychain也会通过iCloud同步。为每一个你登录的站点都创建一个新密码会有点烦人，并且难以记忆。Safari内建了一个密码生成器，为你登录的每个不同站点创建不同的密码，你自己都不需要去记它。</p>

<p><br></p>

<h2>Per App VPN</h2>

<p>有时候，用户需要通过一个安全通道取访问机密信息，因此他们使用VPN。在iOS 7中，苹果允许为不同应用使用不同的VPN。这非常有用，比如你想用公司的app通过公司提供的VPN来访问公司数据，而其他应用，你可能想要用其他VPN。这个功能对政府雇员也很有用，这样他们就可以通过手机应用来访问机密数据。</p>

<p>如果你是一个iOS 开发者并且想要学习iOS引入的新功能，你可以在<a href="https://developer.apple.com/wwdc/videos/">这</a>观看WWDC 2013的视频。</p>

<p><br/>
References:
<a href="http://www.idownloadblog.com/2013/06/15/ios7-game-center-dev-tools/">Apple sticks it to cheaters with Game Center on iOS 7</a></p>

<p><br/>
本文原文是 <a href="http://resources.infosecinstitute.com/ios-application-security-part-6-new-security-features-in-ios-7/">IOS Application Security Part 6 – New Security Features in IOS 7</a></p>

		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
        <a href="1" class="prev">Prev</a>
    
    
        <a href="3" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2015

    小巴


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
		</div>
	</div>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>
